"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[137],{9137:function(e,t,o){o.r(t),o.d(t,{ProductProvider:function(){return g},useProducts:function(){return h}});var r=o(7437),c=o(2265),d=o(3325),n=o(3917),a=o(7440);let s="https://twlegtqcyydgjkycxngw.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR3bGVndHFjeXlkZ2preWN4bmd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxNzQ2MDAsImV4cCI6MjA3Mjc1MDYwMH0.uD9GD_ksHCDgmmPAgR7fcLUAJHRJtTkT-J-SVjU-WR0";if(!s||!i)throw Error("Missing Supabase environment variables. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY");function u(){console.log("Supabase: Products cache cleared")}(0,a.eI)(s,i),u(),console.log("\uD83D\uDE80 Cache buster timestamp:",Date.now());let l=(0,c.createContext)(void 0),g=e=>{let{children:t}=e,[o,a]=(0,c.useState)([]);(0,c.useEffect)(()=>{(async()=>{try{console.log("ProductContext: Loading products...");let e=await n.K.getProducts();if(e.length>0)console.log("ProductContext: Using cached products:",e.length),a(e);else{console.log("ProductContext: No cache, fetching from server...");let e=await d.k.getProducts();console.log("ProductContext: Loaded products from server:",e.length),a(e),n.K.setCache({products:e})}}catch(e){console.error("ProductContext: Error loading products:",e),0===o.length&&a([])}})();let e=e=>{let t=e.detail;t&&t.products&&a(t.products)},t=e=>{let t=e.detail;t&&t.products&&a(t.products)};return window.addEventListener("data-updated",e),window.addEventListener("data-sync",t),()=>{window.removeEventListener("data-updated",e),window.removeEventListener("data-sync",t)}},[]);let s=async e=>{console.log("\uD83D\uDD27 ProductContext: addProduct called with:",e);try{console.log("\uD83D\uDD27 ProductContext: Calling backendService.addProduct...");let t=await d.k.addProduct(e);console.log("\uD83D\uDD27 ProductContext: backendService.addProduct result:",t),t?(console.log("\uD83D\uDD27 ProductContext: Product added successfully, refreshing..."),await h(),console.log("✅ ProductContext: Product added and refreshed successfully")):console.error("❌ ProductContext: backendService.addProduct returned null")}catch(e){console.error("❌ ProductContext: Error in addProduct:",e)}},i=async(e,t)=>{let o=t.stock?Object.values(t.stock).reduce((e,t)=>e+Object.values(t).reduce((e,t)=>e+t,0),0):0,r={...t,inStock:o>0};console.log("ProductContext: Updating product",e,r.name,"Stock:",o,"InStock:",r.inStock),await d.k.updateProduct(e,r)&&await h()},g=async e=>{try{console.log("ProductContext: Deleting product:",e),await d.k.deleteProduct(e)?(console.log("ProductContext: Product deleted successfully:",e),await h()):console.error("ProductContext: Failed to delete product:",e)}catch(e){console.error("ProductContext: Error deleting product:",e)}},h=async()=>{try{console.log("ProductContext: Refreshing products from server..."),u(),n.K.clearCache();let e=await d.k.getProducts();console.log("ProductContext: Refreshed products from server:",e.length),a(e),n.K.setCache({products:e}),window.dispatchEvent(new CustomEvent("data-sync",{detail:{products:e}}))}catch(e){console.error("ProductContext: Error refreshing products:",e)}},P=async()=>{if(0===o.length){let e=[{id:"1",name:"OBSIDIAN HOODIE BLACK",price:4500,originalPrice:5e3,image:"https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=500&h=600&fit=crop",description:"Premium black hoodie with embroidered OBSIDIAN logo. Made from 100% cotton for ultimate comfort.",category:"Hoodies",sizes:["S","M","L","XL"],colors:["Black"],inStock:!0,rating:4.9,reviews:127,stock:{S:{Black:15},M:{Black:20},L:{Black:18},XL:{Black:12}},sku:"OBS-HOODIE-001",weight:.8,tags:["hoodie","black","premium"],featured:!0,createdAt:new Date("2025-01-01"),updatedAt:new Date("2025-01-15")},{id:"2",name:"OBSIDIAN TEE WHITE",price:2500,originalPrice:3e3,image:"https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=500&h=600&fit=crop",description:"Premium white t-shirt with subtle OBSIDIAN branding. 100% cotton oversized fit.",category:"T-Shirts",sizes:["S","M","L","XL"],colors:["White","Black"],inStock:!0,rating:4.8,reviews:89,stock:{S:{White:25,Black:20},M:{White:30,Black:25},L:{White:22,Black:18},XL:{White:18,Black:15}},sku:"OBS-TEE-002",weight:.3,tags:["tshirt","white","black"],featured:!1,createdAt:new Date("2025-01-05"),updatedAt:new Date("2025-01-10")}];for(let t of e){let{id:e,...o}=t;await d.k.addProduct(o)}a(e)}};return(0,r.jsx)(l.Provider,{value:{products:o,setProducts:a,addProduct:s,updateProduct:i,deleteProduct:g,getProduct:e=>o.find(t=>t.id===e),initializeDefaultProducts:P,refreshProducts:h},children:t})},h=()=>{let e=(0,c.useContext)(l);if(void 0===e)throw Error("useProducts must be used within a ProductProvider");return e}}}]);