(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{864:function(e,t,r){Promise.resolve().then(r.t.bind(r,5975,23)),Promise.resolve().then(r.t.bind(r,9979,23)),Promise.resolve().then(r.t.bind(r,3385,23)),Promise.resolve().then(r.bind(r,573)),Promise.resolve().then(r.bind(r,5501)),Promise.resolve().then(r.bind(r,5049)),Promise.resolve().then(r.bind(r,9298)),Promise.resolve().then(r.bind(r,7023)),Promise.resolve().then(r.bind(r,6713)),Promise.resolve().then(r.bind(r,3006))},573:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var s=r(7437),n=r(2265),a=r(4033);function i(){let e=(0,a.usePathname)(),t=(0,a.useRouter)(),[r,i]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{if(e.startsWith("/admin")||"/maintenance"===e||e.startsWith("/_next")||e.includes(".")){i(!1);return}(async()=>{try{let r=await fetch("/api/maintenance"),s=await r.json();(null==s?void 0:s.is_maintenance)&&"/maintenance"!==e&&(console.log("\uD83D\uDD34 Store is in MAINTENANCE MODE - Redirecting to maintenance page"),t.push("/maintenance"))}catch(e){console.error("Error checking maintenance status:",e)}finally{i(!1)}})()},[e,t]),r)?(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-gray-900 rounded-lg p-6 flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"}),(0,s.jsx)("span",{className:"text-white",children:"Checking store status..."})]})}):null}},5501:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return u},useAuth:function(){return d}});var s=r(7437),n=r(2265),a=r(2671);class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}generateSessionId(){{let e=sessionStorage.getItem("obsidian-admin-session-id");return e||(e="admin_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),sessionStorage.setItem("obsidian-admin-session-id",e)),e}}async createSession(e){try{let t=new Date(Date.now()+this.SESSION_DURATION).toISOString(),{error:r}=await a.OQ.from("admin_sessions").upsert({session_id:this.sessionId,username:e,is_active:!0,expires_at:t});if(r)return console.error("Error creating session:",r),!1;return!0}catch(e){return console.error("Error creating session:",e),!1}}async getSession(){try{let{data:e,error:t}=await a.OQ.from("admin_sessions").select("*").eq("session_id",this.sessionId).eq("is_active",!0).single();if(t&&"PGRST116"!==t.code)return console.error("Error fetching session:",t),null;if(!e)return null;let r=new Date,s=new Date(e.expires_at);if(r>s)return await this.deactivateSession(),null;return e}catch(e){return console.error("Error fetching session:",e),null}}async deactivateSession(){try{let{error:e}=await a.OQ.from("admin_sessions").update({is_active:!1}).eq("session_id",this.sessionId);if(e)return console.error("Error deactivating session:",e),!1;return!0}catch(e){return console.error("Error deactivating session:",e),!1}}async isAuthenticated(){return null!==await this.getSession()}async getUsername(){let e=await this.getSession();return(null==e?void 0:e.username)||null}async cleanupExpiredSessions(){try{let e=new Date().toISOString();await a.OQ.from("admin_sessions").update({is_active:!1}).lt("expires_at",e)}catch(e){console.error("Error cleaning up expired sessions:",e)}}constructor(){this.SESSION_DURATION=864e5,this.sessionId=this.generateSessionId()}}var o=i.getInstance();let c=(0,n.createContext)(void 0),l={username:"khvled",password:"Dzt3ch456@"},u=e=>{let{children:t}=e,[r,a]=(0,n.useState)(!1),[i,u]=(0,n.useState)(""),[d,h]=(0,n.useState)(!0);(0,n.useEffect)(()=>{(async()=>{try{if(h(!0),await o.isAuthenticated()){let e=await o.getUsername();a(!0),u(e||"")}else a(!1),u("")}catch(e){console.error("Error checking authentication:",e),a(!1),u("")}finally{h(!1)}})()},[]);let m=async(e,t)=>{if(e===l.username&&t===l.password)try{if(await o.createSession(e))return a(!0),u(e),!0}catch(e){console.error("Error creating session:",e)}return!1},f=async()=>{try{await o.deactivateSession(),a(!1),u("")}catch(e){console.error("Error logging out:",e)}};return(0,s.jsx)(c.Provider,{value:{isAuthenticated:r,login:m,logout:f,username:i,loading:d},children:t})},d=()=>{let e=(0,n.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},5049:function(e,t,r){"use strict";r.r(t),r.d(t,{CartProvider:function(){return d},useCart:function(){return h}});var s=r(7437),n=r(2265),a=r(2671);class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}generateSessionId(){{let e=sessionStorage.getItem("obsidian-cart-session-id");return e||(e="cart_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),sessionStorage.setItem("obsidian-cart-session-id",e)),e}}async getCart(){let e=Date.now();if(this.cache&&e-this.cacheTime<this.CACHE_DURATION)return this.cache.items;try{let{data:t,error:r}=await a.OQ.from("carts").select("*").eq("session_id",this.sessionId).single();if(r&&"PGRST116"!==r.code)return console.error("Error fetching cart:",r),[];if(t)return this.cache=t,this.cacheTime=e,t.items||[];return[]}catch(e){return console.error("Error fetching cart:",e),[]}}async addToCart(e){try{let t;let r=await this.getCart(),s=r.findIndex(t=>t.productId===e.productId&&t.selectedSize===e.selectedSize&&t.selectedColor===e.selectedColor);if(s>=0)(t=[...r])[s]={...t[s],quantity:t[s].quantity+e.quantity};else{let s={...e,id:"item_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)};t=[...r,s]}let{error:n}=await a.OQ.from("carts").upsert({session_id:this.sessionId,items:t,updated_at:new Date().toISOString()});if(n)return console.error("Error saving cart:",n),!1;return this.cache=null,this.cacheTime=0,!0}catch(e){return console.error("Error adding to cart:",e),!1}}async updateCartItem(e,t){try{let r=await this.getCart(),s=r.findIndex(t=>t.id===e);if(-1===s)return!1;let n=[...r];n[s]={...n[s],...t};let{error:i}=await a.OQ.from("carts").upsert({session_id:this.sessionId,items:n,updated_at:new Date().toISOString()});if(i)return console.error("Error updating cart item:",i),!1;return this.cache=null,this.cacheTime=0,!0}catch(e){return console.error("Error updating cart item:",e),!1}}async removeFromCart(e){try{let t=(await this.getCart()).filter(t=>t.id!==e),{error:r}=await a.OQ.from("carts").upsert({session_id:this.sessionId,items:t,updated_at:new Date().toISOString()});if(r)return console.error("Error removing from cart:",r),!1;return this.cache=null,this.cacheTime=0,!0}catch(e){return console.error("Error removing from cart:",e),!1}}async clearCart(){try{let{error:e}=await a.OQ.from("carts").delete().eq("session_id",this.sessionId);if(e)return console.error("Error clearing cart:",e),!1;return this.cache=null,this.cacheTime=0,!0}catch(e){return console.error("Error clearing cart:",e),!1}}async getCartTotal(){return(await this.getCart()).reduce((e,t)=>e+t.price*t.quantity,0)}async getCartItemCount(){return(await this.getCart()).reduce((e,t)=>e+t.quantity,0)}constructor(){this.cache=null,this.cacheTime=0,this.CACHE_DURATION=3e4,this.sessionId=this.generateSessionId()}}var o=i.getInstance(),c=r(3006);let l=(0,n.createContext)(void 0),u=()=>{let[e,t]=(0,n.useState)(()=>()=>{});return(0,n.useEffect)(()=>{try{let e=(0,c.useToast)();(null==e?void 0:e.showToast)&&t(()=>e.showToast)}catch(e){console.log("Toast context not available during SSR")}},[]),e},d=e=>{let{children:t}=e,[r,a]=(0,n.useState)([]),[i,c]=(0,n.useState)(!0),d=u();(0,n.useEffect)(()=>{(async()=>{try{c(!0);let e=await o.getCart();a(e)}catch(e){console.error("Error loading cart:",e)}finally{c(!1)}})()},[]);let h=async(e,t,r,s)=>{var n,i;console.log("CartContext: addToCart called with:",{product:e,selectedSize:t,selectedColor:r,quantity:s});let c=(null===(i=e.stock)||void 0===i?void 0:null===(n=i[t])||void 0===n?void 0:n[r])||0;if(s>c){alert("Only ".concat(c," items available in stock!"));return}let l={productId:e.id,name:e.name,price:e.price,image:e.image,selectedSize:t,selectedColor:r,quantity:s,availableStock:c};try{if(await o.addToCart(l)){let t=await o.getCart();a(t),d("".concat(e.name," added to cart!"),"success")}}catch(e){console.error("Error adding to cart:",e),d("Failed to add item to cart","error")}},m=async e=>{try{if(await o.removeFromCart(e)){let e=await o.getCart();a(e),d("Item removed from cart","info")}}catch(e){console.error("Error removing from cart:",e),d("Failed to remove item from cart","error")}},f=async(e,t)=>{if(t<=0){m(e);return}try{if(await o.updateCartItem(e,{quantity:t})){let e=await o.getCart();a(e)}}catch(e){console.error("Error updating cart quantity:",e)}},g=async()=>{try{await o.clearCart()&&a([])}catch(e){console.error("Error clearing cart:",e)}};return(0,s.jsx)(l.Provider,{value:{items:r,addToCart:h,removeFromCart:m,updateQuantity:f,clearCart:g,getTotalItems:()=>r.reduce((e,t)=>e+t.quantity,0),getTotalPrice:()=>r.reduce((e,t)=>e+t.price*t.quantity,0),loading:i},children:t})},h=()=>{let e=(0,n.useContext)(l);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}},6713:function(e,t,r){"use strict";r.r(t),r.d(t,{ThemeProvider:function(){return i},useTheme:function(){return o}});var s=r(7437),n=r(2265);let a=(0,n.createContext)(void 0);function i(e){let{children:t}=e,[i,o]=(0,n.useState)("dark");return(0,n.useEffect)(()=>{(async()=>{try{let e=(await r.e(755).then(r.bind(r,9755))).default,t=await e.getTheme();if(t&&("light"===t||"dark"===t))o(t);else{let t=localStorage.getItem("admin-theme");t&&("light"===t||"dark"===t)&&(o(t),await e.setTheme(t))}}catch(t){console.error("Error loading theme:",t);let e=localStorage.getItem("admin-theme");e&&("light"===e||"dark"===e)&&o(e)}})()},[]),(0,n.useEffect)(()=>{if(localStorage.setItem("admin-theme",i),(async()=>{try{let e=(await r.e(755).then(r.bind(r,9755))).default;await e.setTheme(i)}catch(e){console.error("Error saving theme to database:",e)}})(),"undefined"!=typeof document){document.documentElement.setAttribute("data-theme",i);let e=document.querySelector('meta[name="theme-color"]');e&&e.setAttribute("content","dark"===i?"#000000":"#ffffff")}},[i]),(0,s.jsx)(a.Provider,{value:{theme:i,toggleTheme:()=>{o(e=>"dark"===e?"light":"dark")},setTheme:e=>{o(e)}},children:t})}function o(){let e=(0,n.useContext)(a);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},3006:function(e,t,r){"use strict";r.r(t),r.d(t,{ToastProvider:function(){return l},useToast:function(){return u}});var s=r(7437),n=r(2265),a=r(3008),i=r(2549);function o(e){let{message:t,type:r="success",duration:o=3e3,onClose:c}=e,[l,u]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{let e=setTimeout(()=>{u(!1),setTimeout(c,300)},o);return()=>clearTimeout(e)},[o,c]),(0,s.jsx)("div",{className:"fixed top-4 right-4 z-50 max-w-sm w-full mx-auto transform transition-all duration-300 ease-in-out ".concat(l?"translate-x-0 opacity-100":"translate-x-full opacity-0"),children:(0,s.jsxs)("div",{className:"".concat((()=>{switch(r){case"success":return"bg-green-50 border-green-200";case"error":return"bg-red-50 border-red-200";default:return"bg-blue-50 border-blue-200"}})()," border rounded-lg shadow-lg p-4 flex items-center space-x-3"),children:[(()=>{switch(r){case"success":return(0,s.jsx)(a.Z,{className:"w-5 h-5 text-green-500"});case"error":return(0,s.jsx)(i.Z,{className:"w-5 h-5 text-red-500"});default:return(0,s.jsx)(a.Z,{className:"w-5 h-5 text-blue-500"})}})(),(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 flex-1",children:t}),(0,s.jsx)("button",{onClick:()=>{u(!1),setTimeout(c,300)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,s.jsx)(i.Z,{className:"w-4 h-4"})})]})})}let c=(0,n.createContext)(void 0);function l(e){let{children:t}=e,[r,a]=(0,n.useState)([]),i=e=>{a(t=>t.filter(t=>t.id!==e))};return(0,s.jsxs)(c.Provider,{value:{showToast:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,s={id:Math.random().toString(36).substr(2,9),message:e,type:t,duration:r};a(e=>[...e,s])}},children:[t,(0,s.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:r.map(e=>(0,s.jsx)(o,{message:e.message,type:e.type,duration:e.duration,onClose:()=>i(e.id)},e.id))})]})}function u(){let e=(0,n.useContext)(c);if(void 0===e)throw Error("useToast must be used within a ToastProvider");return e}},3385:function(){},5975:function(e){e.exports={style:{fontFamily:"'__Inter_e8ce0c', '__Inter_Fallback_e8ce0c'",fontStyle:"normal"},className:"__className_e8ce0c",variable:"__variable_e8ce0c"}},9979:function(e){e.exports={style:{fontFamily:"'__Poppins_51684b', '__Poppins_Fallback_51684b'",fontStyle:"normal"},className:"__className_51684b",variable:"__variable_51684b"}},4033:function(e,t,r){e.exports=r(5313)}},function(e){e.O(0,[316,184,23,971,938,744],function(){return e(e.s=864)}),_N_E=e.O()}]);