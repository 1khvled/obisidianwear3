(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[605],{2601:function(e,r,t){"use strict";var o,c;e.exports=(null==(o=t.g.process)?void 0:o.env)&&"object"==typeof(null==(c=t.g.process)?void 0:c.env)?t.g.process:t(8960)},4843:function(e,r,t){Promise.resolve().then(t.bind(t,8309))},8309:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return a}});var o=t(7437),c=t(3631);function a(){let{products:e,loading:r,lastUpdated:t,timeUntilRefresh:a,refreshProducts:s}=(0,c.P)();return(0,o.jsx)("div",{className:"min-h-screen bg-black text-white p-8",children:(0,o.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"\uD83D\uDED2 User Cache Test Page"}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,o.jsxs)("div",{className:"bg-gray-900 p-6 rounded-lg",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"\uD83D\uDCCA Cache Status"}),(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Loading:"})," ",r?"⏳ Yes":"✅ No"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Products Count:"})," ",e.length]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Last Updated:"})," ",t?t.toLocaleTimeString():"Never"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Time Until Refresh:"})," ",a,"s"]})]}),(0,o.jsx)("button",{onClick:s,className:"mt-4 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded transition-colors",children:"\uD83D\uDD04 Force Refresh"})]}),(0,o.jsxs)("div",{className:"bg-gray-900 p-6 rounded-lg",children:[(0,o.jsxs)("h2",{className:"text-xl font-semibold mb-4",children:["\uD83D\uDCE6 Products (",e.length,")"]}),(0,o.jsxs)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[e.map(e=>(0,o.jsxs)("div",{className:"bg-gray-800 p-3 rounded",children:[(0,o.jsx)("p",{className:"font-medium",children:e.name}),(0,o.jsxs)("p",{className:"text-sm text-gray-400",children:["$",e.price]})]},e.id)),0===e.length&&!r&&(0,o.jsx)("p",{className:"text-gray-400",children:"No products found"})]})]})]}),(0,o.jsxs)("div",{className:"mt-8 bg-yellow-900 p-6 rounded-lg",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"\uD83D\uDCCB How the System Works"}),(0,o.jsxs)("ol",{className:"list-decimal list-inside space-y-2 text-sm",children:[(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"ALWAYS downloads from database first"})," - Every page load fetches fresh data"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"Then uses cached data"})," - If cache is valid (less than 1 minute old), shows cached data"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"Updates cache in background"})," - Fresh data is cached for next time"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"Auto-refresh every minute"})," - Cache expires and fetches fresh data again"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"Admin always fresh"})," - Admin page never uses cache, always gets latest data"]})]}),(0,o.jsx)("div",{className:"mt-4 p-3 bg-yellow-800 rounded",children:(0,o.jsx)("p",{className:"text-sm font-medium",children:"\uD83D\uDD0D Check browser console to see the download process!"})})]})]})})}},3631:function(e,r,t){"use strict";t.d(r,{P:function(){return a}}),t(7437);var o=t(2265);t(3325),t(2136);let c=(0,o.createContext)(void 0),a=()=>{let e=(0,o.useContext)(c);if(void 0===e)throw Error("useUserProducts must be used within a UserProductProvider");return e}},2136:function(e,r,t){"use strict";t.d(r,{d:function(){return a}});let o="user_products_cache",c="user_all_data_cache",a={getProducts(){try{let e=localStorage.getItem(o);if(!e)return null;let r=JSON.parse(e),t=Date.now();if(t>r.expiresAt)return console.log("\uD83D\uDD50 User cache expired, clearing..."),this.clearCache(),null;return console.log("✅ Using cached user data (expires in",Math.round((r.expiresAt-t)/1e3),"seconds)"),console.log("\uD83D\uDCCA Cache contains",r.products.length,"products"),r.products}catch(e){return console.error("❌ Error reading user cache:",e),this.clearCache(),null}},setProducts(e){try{let r=Date.now();localStorage.setItem(o,JSON.stringify({products:e,timestamp:r,expiresAt:r+6e4})),console.log("\uD83D\uDCBE User data cached for 1 minute (",e.length,"products)")}catch(e){console.error("❌ Error setting user cache:",e)}},clearCache(){try{localStorage.removeItem(o),console.log("\uD83D\uDDD1️ User cache cleared")}catch(e){console.error("❌ Error clearing user cache:",e)}},hasValidCache(){try{let e=localStorage.getItem(o);if(!e)return!1;let r=JSON.parse(e);return Date.now()<=r.expiresAt}catch(e){return!1}},getTimeUntilExpiry(){try{let e=localStorage.getItem(o);if(!e)return 0;let r=JSON.parse(e),t=Math.max(0,r.expiresAt-Date.now());return Math.round(t/1e3)}catch(e){return 0}},getAllUserData(){try{let e=localStorage.getItem(c);if(!e)return null;let r=JSON.parse(e),t=Date.now();if(t>r.expiresAt)return console.log("\uD83D\uDD50 All user data cache expired, clearing..."),this.clearAllUserDataCache(),null;return console.log("✅ Using cached all user data (expires in",Math.round((r.expiresAt-t)/1e3),"seconds)"),console.log("\uD83D\uDCCA Cache contains",r.products.length,"products,",r.madeToOrderProducts.length,"made-to-order products,",r.wilayaTariffs.length,"wilayas"),r}catch(e){return console.error("❌ Error reading all user data cache:",e),this.clearAllUserDataCache(),null}},setAllUserData(e){try{let r=Date.now(),t={products:e.products,madeToOrderProducts:e.madeToOrderProducts,wilayaTariffs:e.wilayaTariffs,timestamp:r,expiresAt:r+6e4},o=JSON.stringify(t),a=new Blob([o]).size;if(console.log("\uD83D\uDCCA Cache data size: ".concat(Math.round(a/1024),"KB (").concat(e.products.length," products, ").concat(e.madeToOrderProducts.length," made-to-order products, ").concat(e.wilayaTariffs.length," wilayas)")),a>4194304){console.warn("⚠️ Data too large for localStorage, using individual caches instead"),this.setProducts(e.products);return}localStorage.setItem(c,o),console.log("\uD83D\uDCBE All user data cached for 1 minute")}catch(r){r instanceof DOMException&&"QuotaExceededError"===r.name?(console.warn("⚠️ localStorage quota exceeded, falling back to individual caches"),this.setProducts(e.products)):console.error("❌ Error setting all user data cache:",r)}},clearAllUserDataCache(){try{localStorage.removeItem(c),console.log("\uD83D\uDDD1️ All user data cache cleared")}catch(e){console.error("❌ Error clearing all user data cache:",e)}}}},3325:function(e,r,t){"use strict";t.d(r,{k:function(){return a}});var o=t(2601);class c{getApiUrl(e){return"".concat(this.baseUrl).concat(e)}isBrowser(){return"undefined"!=typeof fetch}getAuthHeaders(){let e=o.env.NEXT_PUBLIC_API_AUTH_TOKEN||"obsidian-api-token-2025";return console.log("\uD83D\uDD27 BackendService: Using auth token:",e),{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}async getProducts(){try{let e=await fetch(this.getApiUrl("/products"),{method:"GET",headers:{"Content-Type":"application/json","Cache-Control":"max-age=30"},next:{revalidate:30}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let r=await e.json();if(r.success)return console.log("BackendService: Fetched",r.count,"products"),r.data||[];return console.error("BackendService: Failed to fetch products:",r.error),[]}catch(e){return console.error("BackendService: Error fetching products:",e),[]}}async getProduct(e){try{let r=await fetch(this.getApiUrl("/products/".concat(e))),t=await r.json();if(t.success)return console.log("BackendService: Fetched product:",e),t.data;return console.error("BackendService: Failed to fetch product:",t.error),null}catch(e){return console.error("BackendService: Error fetching product:",e),null}}async addProduct(e){try{console.log("\uD83D\uDD27 BackendService: addProduct called with:",e),console.log("\uD83D\uDD27 BackendService: Product price type:",typeof e.price,"Value:",e.price),console.log("\uD83D\uDD27 BackendService: JSON stringified product:",JSON.stringify(e,null,2)),console.log("\uD83D\uDD27 BackendService: API URL:",this.getApiUrl("/products")),console.log("\uD83D\uDD27 BackendService: Auth headers:",this.getAuthHeaders());let r=await fetch(this.getApiUrl("/products"),{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(e)});console.log("\uD83D\uDD27 BackendService: Response status:",r.status),console.log("\uD83D\uDD27 BackendService: Response ok:",r.ok);let t=await r.json();if(console.log("\uD83D\uDD27 BackendService: Response data:",t),t.success)return console.log("✅ BackendService: Created product:",t.data.id),t.data;return console.error("❌ BackendService: Failed to create product:",t.error),null}catch(e){return console.error("❌ BackendService: Error creating product:",e),null}}async updateProduct(e,r){try{let t=await fetch(this.getApiUrl("/products/".concat(e)),{method:"PUT",headers:this.getAuthHeaders(),body:JSON.stringify(r)}),o=await t.json();if(o.success)return console.log("BackendService: Updated product:",e),o.data;return console.error("BackendService: Failed to update product:",o.error),null}catch(e){return console.error("BackendService: Error updating product:",e),null}}async deleteProduct(e){try{let r=await fetch(this.getApiUrl("/products/".concat(e)),{method:"DELETE",headers:this.getAuthHeaders()}),t=await r.json();if(t.success)return console.log("BackendService: Deleted product:",e),!0;return console.error("BackendService: Failed to delete product:",t.error),!1}catch(e){return console.error("BackendService: Error deleting product:",e),!1}}async getOrders(){try{let e=await fetch(this.getApiUrl("/orders"),{method:"GET",headers:{"Content-Type":"application/json","Cache-Control":"max-age=30"},next:{revalidate:30}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let r=e.headers.get("content-type");if(!r||!r.includes("application/json")){let t=await e.text();return console.error("BackendService: Received non-JSON response:",{status:e.status,contentType:r,text:t.substring(0,200)}),[]}let t=await e.json();if(t.success)return console.log("BackendService: Fetched",t.count,"orders"),t.data||[];return console.error("BackendService: Failed to fetch orders:",t.error),[]}catch(e){return console.error("BackendService: Error fetching orders:",e),[]}}async getOrder(e){try{let r=await fetch(this.getApiUrl("/orders/".concat(e))),t=await r.json();if(t.success)return console.log("BackendService: Fetched order:",e),t.data;return console.error("BackendService: Failed to fetch order:",t.error),null}catch(e){return console.error("BackendService: Error fetching order:",e),null}}async addOrder(e){try{let r=await fetch(this.getApiUrl("/orders"),{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(e)}),t=await r.json();if(t.success)return console.log("BackendService: Created order:",t.data.id),t.data;return console.error("BackendService: Failed to create order:",t.error),null}catch(e){return console.error("BackendService: Error creating order:",e),null}}async updateOrder(e,r){try{let t=await fetch(this.getApiUrl("/orders/".concat(e)),{method:"PUT",headers:this.getAuthHeaders(),body:JSON.stringify(r)}),o=await t.json();if(o.success)return console.log("BackendService: Updated order:",e),o.data;return console.error("BackendService: Failed to update order:",o.error),null}catch(e){return console.error("BackendService: Error updating order:",e),null}}async deleteOrder(e){try{let r=await fetch(this.getApiUrl("/orders/".concat(e)),{method:"DELETE",headers:this.getAuthHeaders()}),t=await r.json();if(t.success)return console.log("BackendService: Deleted order:",e),!0;return console.error("BackendService: Failed to delete order:",t.error),!1}catch(e){return console.error("BackendService: Error deleting order:",e),!1}}async getCustomers(){try{let e=await fetch(this.getApiUrl("/customers")),r=await e.json();if(r.success)return console.log("BackendService: Fetched",r.count,"customers"),r.data||[];return console.error("BackendService: Failed to fetch customers:",r.error),[]}catch(e){return console.error("BackendService: Error fetching customers:",e),[]}}async addCustomer(e){try{let r=await fetch(this.getApiUrl("/customers"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await r.json();if(t.success)return console.log("BackendService: Created customer:",t.data.id),t.data;return console.error("BackendService: Failed to create customer:",t.error),null}catch(e){return console.error("BackendService: Error creating customer:",e),null}}async getWilayaTariffs(){try{let e=await fetch(this.getApiUrl("/wilaya")),r=await e.json();if(r.success)return console.log("BackendService: Fetched",r.count,"wilaya tariffs"),r.data||[];return console.error("BackendService: Failed to fetch wilaya tariffs:",r.error),[]}catch(e){return console.error("BackendService: Error fetching wilaya tariffs:",e),[]}}async updateWilayaTariffs(e){try{let r=await fetch(this.getApiUrl("/wilaya"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await r.json();if(t.success)return console.log("BackendService: Updated wilaya tariffs"),!0;return console.error("BackendService: Failed to update wilaya tariffs:",t.error),!1}catch(e){return console.error("BackendService: Error updating wilaya tariffs:",e),!1}}constructor(){this.baseUrl="/api"}}let a=new c},8960:function(e){!function(){var r={229:function(e){var r,t,o,c=e.exports={};function a(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function n(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{t="function"==typeof clearTimeout?clearTimeout:s}catch(e){t=s}}();var i=[],l=!1,d=-1;function u(){l&&o&&(l=!1,o.length?i=o.concat(i):d=-1,i.length&&h())}function h(){if(!l){var e=n(u);l=!0;for(var r=i.length;r;){for(o=i,i=[];++d<r;)o&&o[d].run();d=-1,r=i.length}o=null,l=!1,function(e){if(t===clearTimeout)return clearTimeout(e);if((t===s||!t)&&clearTimeout)return t=clearTimeout,clearTimeout(e);try{t(e)}catch(r){try{return t.call(null,e)}catch(r){return t.call(this,e)}}}(e)}}function f(e,r){this.fun=e,this.array=r}function g(){}c.nextTick=function(e){var r=Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)r[t-1]=arguments[t];i.push(new f(e,r)),1!==i.length||l||n(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=g,c.addListener=g,c.once=g,c.off=g,c.removeListener=g,c.removeAllListeners=g,c.emit=g,c.prependListener=g,c.prependOnceListener=g,c.listeners=function(e){return[]},c.binding=function(e){throw Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw Error("process.chdir is not supported")},c.umask=function(){return 0}}},t={};function o(e){var c=t[e];if(void 0!==c)return c.exports;var a=t[e]={exports:{}},s=!0;try{r[e](a,a.exports,o),s=!1}finally{s&&delete t[e]}return a.exports}o.ab="//";var c=o(229);e.exports=c}()},622:function(e,r,t){"use strict";var o=t(2265),c=Symbol.for("react.element"),a=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,n=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function l(e,r,t){var o,a={},l=null,d=null;for(o in void 0!==t&&(l=""+t),void 0!==r.key&&(l=""+r.key),void 0!==r.ref&&(d=r.ref),r)s.call(r,o)&&!i.hasOwnProperty(o)&&(a[o]=r[o]);if(e&&e.defaultProps)for(o in r=e.defaultProps)void 0===a[o]&&(a[o]=r[o]);return{$$typeof:c,type:e,key:l,ref:d,props:a,_owner:n.current}}r.Fragment=a,r.jsx=l,r.jsxs=l},7437:function(e,r,t){"use strict";e.exports=t(622)}},function(e){e.O(0,[971,938,744],function(){return e(e.s=4843)}),_N_E=e.O()}]);