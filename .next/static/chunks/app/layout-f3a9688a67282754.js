(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{9434:function(e,t,r){Promise.resolve().then(r.t.bind(r,5975,23)),Promise.resolve().then(r.t.bind(r,9979,23)),Promise.resolve().then(r.t.bind(r,3385,23)),Promise.resolve().then(r.bind(r,573)),Promise.resolve().then(r.bind(r,8628)),Promise.resolve().then(r.bind(r,2095)),Promise.resolve().then(r.bind(r,9298)),Promise.resolve().then(r.bind(r,3471)),Promise.resolve().then(r.bind(r,6713))},573:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return n}});var a=r(2265),o=r(4033);function n(){let e=(0,o.usePathname)(),t=(0,o.useRouter)(),[r,n]=(0,a.useState)(!1);(0,a.useEffect)(()=>{l()},[e]);let l=async()=>{if(e.startsWith("/admin")||"/maintenance"===e||e.startsWith("/_next")||e.includes(".")){n(!0);return}try{let r=await fetch("/api/maintenance"),a=await r.json();!0===a.is_maintenance_mode&&"/maintenance"!==e&&(console.log("\uD83D\uDD34 Store is OFF - Redirecting to maintenance page"),t.push("/maintenance"))}catch(e){console.error("Error checking store status:",e)}finally{n(!0)}};return null}},8628:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return l},useAuth:function(){return i}});var a=r(7437),o=r(2265);let n=(0,o.createContext)(void 0),l=e=>{let{children:t}=e,[r,l]=(0,o.useState)(!1),[i,s]=(0,o.useState)("");return(0,o.useEffect)(()=>{{let e=localStorage.getItem("obsidian-admin-auth"),t=localStorage.getItem("obsidian-admin-username");"true"===e&&t&&(l(!0),s(t))}},[]),(0,a.jsx)(n.Provider,{value:{isAuthenticated:r,login:(e,t)=>(l(!0),s(e),localStorage.setItem("obsidian-admin-auth","true"),localStorage.setItem("obsidian-admin-username",e),!0),logout:()=>{l(!1),s(""),localStorage.removeItem("obsidian-admin-auth"),localStorage.removeItem("obsidian-admin-username")},username:i},children:t})},i=()=>{let e=(0,o.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},2095:function(e,t,r){"use strict";r.r(t),r.d(t,{CartProvider:function(){return l},useCart:function(){return i}});var a=r(7437),o=r(2265);let n=(0,o.createContext)(void 0),l=e=>{let{children:t}=e,[r,l]=(0,o.useState)([]),[i,s]=(0,o.useState)(!1),[c,u]=(0,o.useState)(null);(0,o.useEffect)(()=>{(()=>{try{let e=localStorage.getItem("obsidian-cart");if(e){let t=JSON.parse(e);if(Array.isArray(t)){let e=t.map(e=>({...e,addedAt:e.addedAt||new Date().toISOString()}));l(e),console.log("Cart loaded from localStorage:",e.length,"items")}else console.warn("Invalid cart data structure, clearing cart"),localStorage.removeItem("obsidian-cart")}u(null)}catch(e){console.error("Error loading cart from localStorage:",e),u("Failed to load cart data"),localStorage.removeItem("obsidian-cart")}finally{s(!0)}})()},[]),(0,o.useEffect)(()=>{if(i)try{localStorage.setItem("obsidian-cart",JSON.stringify(r)),console.log("Cart saved to localStorage:",r.length,"items"),u(null)}catch(e){console.error("Error saving cart to localStorage:",e),u("Failed to save cart data")}},[r,i]);let d=e=>{l(t=>t.filter(t=>t.id!==e))};return(0,a.jsx)(n.Provider,{value:{items:r,addToCart:(e,t,r,a)=>{console.log("CartContext: addToCart called with:",{product:e,selectedSize:t,selectedColor:r,quantity:a});let o="".concat(e.id,"-").concat(t,"-").concat(r);l(n=>{var l,i,s,c;let u=n.find(e=>e.id===o);if(u){let s=u.quantity+a;return s<=((null===(i=e.stock)||void 0===i?void 0:null===(l=i[t])||void 0===l?void 0:l[r])||999)?n.map(e=>e.id===o?{...e,quantity:s}:e):(alert("This item is not available in the selected size and color!"),n)}{let l=(null===(c=e.stock)||void 0===c?void 0:null===(s=c[t])||void 0===s?void 0:s[r])||0;return!e.stock||0===l&&e.stock[t]&&Math.max(...Object.values(e.stock[t]))>0?[...n,{id:o,productId:e.id,name:e.name,price:e.price,image:e.image,selectedSize:t,selectedColor:r,quantity:a,addedAt:new Date().toISOString()}]:a<=l?[...n,{id:o,productId:e.id,name:e.name,price:e.price,image:e.image,selectedSize:t,selectedColor:r,quantity:a,addedAt:new Date().toISOString()}]:(alert("This item is not available in the selected size and color!"),n)}})},removeFromCart:d,updateQuantity:(e,t)=>{if(t<=0){d(e);return}l(r=>r.map(r=>{if(r.id===e){if(t<=10)return{...r,quantity:t};alert("Maximum ".concat(10," items allowed per product!"))}return r}))},clearCart:()=>{l([]),localStorage.removeItem("obsidian-cart")},getTotalItems:()=>r.reduce((e,t)=>e+t.quantity,0),getTotalPrice:()=>r.reduce((e,t)=>e+t.price*t.quantity,0),isCartLoaded:i,cartError:c},children:t})},i=()=>{let e=(0,o.useContext)(n);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}},3471:function(e,t,r){"use strict";r.r(t),r.d(t,{SmartProductProvider:function(){return m},useAdminProducts:function(){return l.R},useProducts:function(){return f},useUserProducts:function(){return h.P}});var a=r(7437),o=r(2265),n=r(4033),l=r(9137),i=r(3325),s=r(2136);let c=(0,o.createContext)(void 0),u=e=>{let{children:t}=e,[r,n]=(0,o.useState)([]),[l,u]=(0,o.useState)([]),[d,h]=(0,o.useState)([]),[m,f]=(0,o.useState)(!0),[g,p]=(0,o.useState)(null),[D,v]=(0,o.useState)(0),S=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{if(f(!0),console.log("\uD83D\uDE80 OptimizedUserDataContext: Loading all user data..."),!e&&s.d.hasValidCache()){let e=s.d.getAllUserData();if(e){console.log("✅ Using cached user data (expires in",s.d.getTimeUntilExpiry(),"seconds)"),n(e.products||[]),u(e.madeToOrderProducts||[]),h(e.wilayaTariffs||[]),p(new Date),v(s.d.getTimeUntilExpiry()),f(!1),console.log("\uD83D\uDD04 Updating cache in background..."),y().catch(e=>{console.error("❌ Background cache update failed:",e)});return}}console.log("\uD83C\uDD95 No valid cache, fetching fresh data and caching for 1 minute"),await y()}catch(e){console.error("❌ OptimizedUserDataContext: Error loading user data:",e),f(!1)}},y=async()=>{try{console.log("\uD83C\uDF10 Fetching fresh data from all sources...");let[e,t,r]=await Promise.all([fetch("/api/products").then(e=>e.json()),fetch("/api/made-to-order").then(e=>e.json()),i.k.getWilayaTariffs()]),a=e.success?e.data:[];console.log("✅ Downloaded fresh data:",{products:a.length,madeToOrder:t.length,wilayas:r.length}),n(a),u(t),h(r),p(new Date),v(60),f(!1),s.d.setAllUserData({products:a,madeToOrderProducts:t,wilayaTariffs:r}),console.log("\uD83D\uDCBE Cached all user data for 1 minute")}catch(e){console.error("❌ Error fetching fresh data:",e),f(!1)}},P=async()=>{console.log("\uD83D\uDD04 OptimizedUserDataContext: Force refreshing all data..."),await S(!0)};return(0,o.useEffect)(()=>{S();let e=setInterval(()=>{console.log("⏰ OptimizedUserDataContext: Auto-refreshing all data..."),S(!0)},6e4),t=setInterval(()=>{v(s.d.getTimeUntilExpiry())},1e3);return()=>{clearInterval(e),clearInterval(t)}},[]),(0,a.jsx)(c.Provider,{value:{products:r,madeToOrderProducts:l,wilayaTariffs:d,loading:m,lastUpdated:g,timeUntilRefresh:D,refreshAllData:P,getProduct:e=>r.find(t=>t.id===e),getMadeToOrderProduct:e=>l.find(t=>t.id===e)},children:t})},d=()=>{let e=(0,o.useContext)(c);if(void 0===e)throw Error("useOptimizedUserData must be used within an OptimizedUserDataProvider");return e};var h=r(3631);let m=e=>{let{children:t}=e,r=(0,n.usePathname)();return(null==r?void 0:r.startsWith("/admin"))?(console.log("\uD83D\uDD27 Using AdminProductProvider (no cache)"),(0,a.jsx)(l.V,{children:t})):(console.log("\uD83D\uDE80 Using OptimizedUserDataProvider (loads all user data at once)"),(0,a.jsx)(u,{children:t}))},f=()=>{let e=(0,n.usePathname)();if(null==e?void 0:e.startsWith("/admin"))return(0,l.R)();{let e=d();return{products:e.products,loading:e.loading,lastUpdated:e.lastUpdated,timeUntilRefresh:e.timeUntilRefresh,refreshProducts:e.refreshAllData,getProduct:e.getProduct}}}},6713:function(e,t,r){"use strict";r.r(t),r.d(t,{ThemeProvider:function(){return l},useTheme:function(){return i}});var a=r(7437),o=r(2265);let n=(0,o.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,o.useState)("dark");return(0,o.useEffect)(()=>{let e=localStorage.getItem("admin-theme");e&&l(e)},[]),(0,o.useEffect)(()=>{localStorage.setItem("admin-theme",r),document.documentElement.setAttribute("data-theme",r);let e=document.querySelector('meta[name="theme-color"]');e&&e.setAttribute("content","dark"===r?"#000000":"#ffffff")},[r]),(0,a.jsx)(n.Provider,{value:{theme:r,toggleTheme:()=>{l(e=>"dark"===e?"light":"dark")},setTheme:e=>{l(e)}},children:t})}function i(){let e=(0,o.useContext)(n);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},3631:function(e,t,r){"use strict";r.d(t,{P:function(){return n}}),r(7437);var a=r(2265);r(3325),r(2136);let o=(0,a.createContext)(void 0),n=()=>{let e=(0,a.useContext)(o);if(void 0===e)throw Error("useUserProducts must be used within a UserProductProvider");return e}},2136:function(e,t,r){"use strict";r.d(t,{d:function(){return n}});let a="user_products_cache",o="user_all_data_cache",n={getProducts(){try{let e=localStorage.getItem(a);if(!e)return null;let t=JSON.parse(e),r=Date.now();if(r>t.expiresAt)return console.log("\uD83D\uDD50 User cache expired, clearing..."),this.clearCache(),null;return console.log("✅ Using cached user data (expires in",Math.round((t.expiresAt-r)/1e3),"seconds)"),console.log("\uD83D\uDCCA Cache contains",t.products.length,"products"),t.products}catch(e){return console.error("❌ Error reading user cache:",e),this.clearCache(),null}},setProducts(e){try{let t=Date.now();localStorage.setItem(a,JSON.stringify({products:e,timestamp:t,expiresAt:t+6e4})),console.log("\uD83D\uDCBE User data cached for 1 minute (",e.length,"products)")}catch(e){console.error("❌ Error setting user cache:",e)}},clearCache(){try{localStorage.removeItem(a),console.log("\uD83D\uDDD1️ User cache cleared")}catch(e){console.error("❌ Error clearing user cache:",e)}},hasValidCache(){try{let e=localStorage.getItem(a);if(!e)return!1;let t=JSON.parse(e);return Date.now()<=t.expiresAt}catch(e){return!1}},getTimeUntilExpiry(){try{let e=localStorage.getItem(a);if(!e)return 0;let t=JSON.parse(e),r=Math.max(0,t.expiresAt-Date.now());return Math.round(r/1e3)}catch(e){return 0}},getAllUserData(){try{let e=localStorage.getItem(o);if(!e)return null;let t=JSON.parse(e),r=Date.now();if(r>t.expiresAt)return console.log("\uD83D\uDD50 All user data cache expired, clearing..."),this.clearAllUserDataCache(),null;return console.log("✅ Using cached all user data (expires in",Math.round((t.expiresAt-r)/1e3),"seconds)"),console.log("\uD83D\uDCCA Cache contains",t.products.length,"products,",t.madeToOrderProducts.length,"made-to-order products,",t.wilayaTariffs.length,"wilayas"),t}catch(e){return console.error("❌ Error reading all user data cache:",e),this.clearAllUserDataCache(),null}},setAllUserData(e){try{let t=Date.now(),r={products:e.products,madeToOrderProducts:e.madeToOrderProducts,wilayaTariffs:e.wilayaTariffs,timestamp:t,expiresAt:t+6e4},a=JSON.stringify(r),n=new Blob([a]).size;if(console.log("\uD83D\uDCCA Cache data size: ".concat(Math.round(n/1024),"KB (").concat(e.products.length," products, ").concat(e.madeToOrderProducts.length," made-to-order products, ").concat(e.wilayaTariffs.length," wilayas)")),n>4194304){console.warn("⚠️ Data too large for localStorage, using individual caches instead"),this.setProducts(e.products);return}localStorage.setItem(o,a),console.log("\uD83D\uDCBE All user data cached for 1 minute")}catch(t){t instanceof DOMException&&"QuotaExceededError"===t.name?(console.warn("⚠️ localStorage quota exceeded, falling back to individual caches"),this.setProducts(e.products)):console.error("❌ Error setting all user data cache:",t)}},clearAllUserDataCache(){try{localStorage.removeItem(o),console.log("\uD83D\uDDD1️ All user data cache cleared")}catch(e){console.error("❌ Error clearing all user data cache:",e)}}}},3385:function(){},5975:function(e){e.exports={style:{fontFamily:"'__Inter_e8ce0c', '__Inter_Fallback_e8ce0c'",fontStyle:"normal"},className:"__className_e8ce0c",variable:"__variable_e8ce0c"}},9979:function(e){e.exports={style:{fontFamily:"'__Poppins_51684b', '__Poppins_Fallback_51684b'",fontStyle:"normal"},className:"__className_51684b",variable:"__variable_51684b"}},622:function(e,t,r){"use strict";var a=r(2265),o=Symbol.for("react.element"),n=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,i=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var a,n={},c=null,u=null;for(a in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)l.call(t,a)&&!s.hasOwnProperty(a)&&(n[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===n[a]&&(n[a]=t[a]);return{$$typeof:o,type:e,key:c,ref:u,props:n,_owner:i.current}}t.Fragment=n,t.jsx=c,t.jsxs=c},7437:function(e,t,r){"use strict";e.exports=r(622)},4033:function(e,t,r){e.exports=r(5313)}},function(e){e.O(0,[440,298,137,971,938,744],function(){return e(e.s=9434)}),_N_E=e.O()}]);