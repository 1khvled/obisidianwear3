"use strict";exports.id=4750,exports.ids=[4750],exports.modules={4750:(e,t,r)=>{r.d(t,{AU:()=>f,Cs:()=>b,Ir:()=>g,OL:()=>O,OQ:()=>n,Qc:()=>z,Qu:()=>C,Sy:()=>P,Xp:()=>u,co:()=>h,fS:()=>w,gK:()=>m,ix:()=>I,n3:()=>k,nE:()=>v,nM:()=>p,wH:()=>D});var o=r(32409);let a="https://twlegtqcyydgjkycxngw.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR3bGVndHFjeXlkZ2preWN4bmd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxNzQ2MDAsImV4cCI6MjA3Mjc1MDYwMH0.uD9GD_ksHCDgmmPAgR7fcLUAJHRJtTkT-J-SVjU-WR0";if(!a||!s)throw Error("Missing Supabase environment variables. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY");let n=(0,o.eI)(a,s);function i(e){console.log("\uD83D\uDD0D DEBUG: Raw price from DB:",e.price,"Type:",typeof e.price),console.log("\uD83D\uDD0D DEBUG: Parsed price:",parseFloat(e.price),"Type:",typeof parseFloat(e.price));let t={id:e.id,name:e.name,description:e.description,price:parseFloat(e.price),originalPrice:e.original_price?parseFloat(e.original_price):void 0,image:e.image,images:e.images||[],stock:e.stock||{},category:e.category,sizes:e.sizes||[],colors:e.colors||[],inStock:e.in_stock,rating:parseFloat(e.rating||0),reviews:e.reviews||0,sku:e.sku,weight:e.weight?parseFloat(e.weight):void 0,dimensions:e.dimensions,tags:e.tags||[],featured:e.featured||!1,sizeChartCategory:e.size_chart_category||"T-Shirts",customSizeChart:e.custom_size_chart||void 0,useCustomSizeChart:e.use_custom_size_chart||!1,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)};return console.log("\uD83D\uDD0D DEBUG: Final converted product price:",t.price,"Type:",typeof t.price),t}let c=null,d=0;async function u(){try{if(c&&Date.now()-d<3e4)return console.log("Supabase: Returning cached products"),c;let{data:e,error:t}=await n.from("products").select("*").order("created_at",{ascending:!1});if(t)return console.error("Supabase getProducts error:",t),c||[];let r=(e||[]).map(i);return c=r,d=Date.now(),r}catch(e){return console.error("Supabase getProducts error:",e),c||[]}}async function l(e){try{let{data:t,error:r}=await n.from("products").select("*").eq("id",e).single();if(r)return console.error("Supabase getProduct error:",r),null;return i(t)}catch(e){return console.error("Supabase getProduct error:",e),null}}async function m(e){try{if(console.log("\uD83D\uDD27 Supabase addProduct: Starting to add product:",e.id,e.name),!n)throw console.error("❌ Supabase: Client not initialized"),Error("Supabase client not initialized");let t={id:e.id,name:e.name,description:e.description,price:e.price,original_price:e.originalPrice,image:e.image,images:e.images||[],stock:e.stock,category:e.category,sizes:e.sizes||[],colors:e.colors||[],in_stock:e.inStock,rating:e.rating,reviews:e.reviews,sku:e.sku,weight:e.weight,dimensions:e.dimensions,tags:e.tags||[],featured:e.featured||!1,custom_size_chart:e.customSizeChart||null,use_custom_size_chart:e.useCustomSizeChart||!1,size_chart_category:e.sizeChartCategory||e.category};console.log("\uD83D\uDD27 Supabase addProduct: Database product object:",JSON.stringify(t,null,2)),console.log("\uD83D\uDD27 Supabase addProduct: Attempting to insert into products table...");let{data:o,error:a}=await n.from("products").insert([t]).select().single();if(console.log("\uD83D\uDD27 Supabase addProduct: Insert result - data:",o),console.log("\uD83D\uDD27 Supabase addProduct: Insert result - error:",a),a)throw console.error("❌ Supabase addProduct error:",a),console.error("❌ Supabase addProduct error details:",JSON.stringify(a,null,2)),console.error("❌ Supabase addProduct error code:",a.code),console.error("❌ Supabase addProduct error message:",a.message),console.error("❌ Supabase addProduct error hint:",a.hint),Error(`Supabase insert failed: ${a.message} (Code: ${a.code})`);console.log("Supabase: Added product:",e.id);try{let{initializeProductInventory:t}=await r.e(8755).then(r.bind(r,78755));await t(e.id),console.log("Supabase: Initialized inventory for product:",e.id)}catch(t){console.error("Supabase: Failed to initialize inventory for product:",e.id,t)}return c=null,i(o)}catch(e){throw console.error("Supabase addProduct error:",e),e}}async function p(e,t){try{let r={};void 0!==t.name&&(r.name=t.name),void 0!==t.description&&(r.description=t.description),void 0!==t.price&&(r.price=t.price),void 0!==t.originalPrice&&(r.original_price=t.originalPrice),void 0!==t.image&&(r.image=t.image),void 0!==t.images&&(r.images=t.images),void 0!==t.stock&&(r.stock=t.stock),void 0!==t.category&&(r.category=t.category),void 0!==t.sizes&&(r.sizes=t.sizes),void 0!==t.colors&&(r.colors=t.colors),void 0!==t.inStock&&(r.in_stock=t.inStock),void 0!==t.rating&&(r.rating=t.rating),void 0!==t.reviews&&(r.reviews=t.reviews),void 0!==t.sku&&(r.sku=t.sku),void 0!==t.weight&&(r.weight=t.weight),void 0!==t.dimensions&&(r.dimensions=t.dimensions),void 0!==t.tags&&(r.tags=t.tags),void 0!==t.featured&&(r.featured=t.featured),void 0!==t.sizeChartCategory&&(r.size_chart_category=t.sizeChartCategory),void 0!==t.customSizeChart&&(r.custom_size_chart=t.customSizeChart),void 0!==t.useCustomSizeChart&&(r.use_custom_size_chart=t.useCustomSizeChart);let{data:o,error:a}=await n.from("products").update(r).eq("id",e).select().single();if(a)return console.error("Supabase updateProduct error:",a),null;return console.log("Supabase: Updated product:",e),c=null,i(o)}catch(e){return console.error("Supabase updateProduct error:",e),null}}async function g(e){try{let{error:t}=await n.from("products").delete().eq("id",e);if(t)return console.error("Supabase deleteProduct error:",t),!1;return console.log("Supabase: Deleted product:",e),c=null,!0}catch(e){return console.error("Supabase deleteProduct error:",e),!1}}function S(e){let t=e.items&&e.items.length>0?e.items[0]:{};return{id:e.id,productId:t.productId||"",productName:t.productName||"",productImage:t.productImage||"",customerName:t.customerName||"",customerPhone:t.customerPhone||"",customerEmail:t.customerEmail||"",customerAddress:t.customerAddress||"",customerCity:t.customerCity||"",wilayaId:t.wilayaId||0,wilayaName:t.wilayaName||"",shippingType:e.shipping_type||"homeDelivery",shippingCost:Number(e.shipping_cost)||0,quantity:t.quantity||1,selectedSize:t.selectedSize||"",selectedColor:t.selectedColor||"",subtotal:Number(e.total)-Number(e.shipping_cost)||0,total:Number(e.total)||0,orderDate:new Date(e.order_date),status:e.status||"pending",trackingNumber:e.tracking_number,notes:t.notes,paymentMethod:e.payment_method||"cod",paymentStatus:e.payment_status||"pending",estimatedDelivery:t.estimatedDelivery,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}c=null,d=0,console.log("Supabase: Products cache cleared"),console.log("\uD83D\uDE80 Cache buster timestamp:",Date.now());let y=null,_=0;async function f(){try{if(y&&Date.now()-_<3e4)return console.log("Supabase: Returning cached orders"),y;let{data:e,error:t}=await n.from("orders").select("*").order("order_date",{ascending:!1});if(t)return console.error("Supabase getOrders error:",t),y||[];let r=(e||[]).map(S);return y=r,_=Date.now(),r}catch(e){return console.error("Supabase getOrders error:",e),y||[]}}async function h(e){try{let{data:t,error:r}=await n.from("orders").select("*").eq("id",e).single();if(r)return console.error("Supabase getOrder error:",r),null;return S(t)}catch(e){return console.error("Supabase getOrder error:",e),null}}async function w(e){try{let t={id:e.id,customer_id:`CUST-${Date.now()}`,items:[{productId:e.productId,productName:e.productName,productImage:e.productImage,customerName:e.customerName,customerPhone:e.customerPhone,customerEmail:e.customerEmail,customerAddress:e.customerAddress,customerCity:e.customerCity,wilayaId:e.wilayaId,wilayaName:e.wilayaName,quantity:e.quantity,selectedSize:e.selectedSize,selectedColor:e.selectedColor,notes:e.notes,estimatedDelivery:e.estimatedDelivery}],total:e.total,shipping_cost:e.shippingCost,shipping_type:e.shippingType,payment_method:e.paymentMethod,payment_status:e.paymentStatus,status:e.status,tracking_number:e.trackingNumber,order_date:e.orderDate.toISOString(),created_at:e.createdAt.toISOString(),updated_at:e.updatedAt.toISOString()},{data:r,error:o}=await n.from("orders").insert([t]).select().single();if(o)throw console.error("Supabase addOrder error:",o),o;return console.log("Supabase: Added order:",e.id),S(r)}catch(e){throw console.error("Supabase addOrder error:",e),e}}async function b(e,t){try{let r={updated_at:new Date().toISOString()};void 0!==t.status&&(r.status=t.status),void 0!==t.paymentStatus&&(r.payment_status=t.paymentStatus),void 0!==t.trackingNumber&&(r.tracking_number=t.trackingNumber),void 0!==t.shippingType&&(r.shipping_type=t.shippingType),void 0!==t.shippingCost&&(r.shipping_cost=t.shippingCost),void 0!==t.total&&(r.total=t.total),void 0!==t.paymentMethod&&(r.payment_method=t.paymentMethod);let{data:o,error:a}=await n.from("orders").update(r).eq("id",e).select().single();if(a)return console.error("Supabase updateOrder error:",a),null;return console.log("Supabase: Updated order:",e),S(o)}catch(e){return console.error("Supabase updateOrder error:",e),null}}async function D(e){try{let t=await h(e);if(!t)return console.error("Supabase deleteOrder: Order not found:",e),!1;if(t.productId&&t.selectedSize&&t.selectedColor&&t.quantity)try{let{addInventory:o}=await r.e(8755).then(r.bind(r,78755));await o(t.productId,t.selectedSize,t.selectedColor,t.quantity,`Order ${e} deleted - inventory restored`,"admin")?console.log("Supabase deleteOrder: Inventory restored for order:",e):console.warn("Supabase deleteOrder: Failed to restore inventory for order:",e)}catch(e){console.error("Supabase deleteOrder: Inventory restoration error:",e)}let{error:o}=await n.from("orders").delete().eq("id",e);if(o)return console.error("Supabase deleteOrder error:",o),!1;return console.log("Supabase: Deleted order:",e),!0}catch(e){return console.error("Supabase deleteOrder error:",e),!1}}async function k(){try{let{data:e,error:t}=await n.from("wilaya_tariffs").select("*").order("order",{ascending:!0});if(t)return console.error("Supabase getWilayaTariffs error:",t),[];return(e||[]).map(e=>({id:e.id.toString(),wilaya_id:e.wilaya_id,name:e.name,domicile_ecommerce:e.domicile_ecommerce,stop_desk_ecommerce:e.stop_desk_ecommerce,order:e.order,home_delivery:e.domicile_ecommerce,stop_desk:e.stop_desk_ecommerce,homeDelivery:e.domicile_ecommerce,stopDesk:e.stop_desk_ecommerce,domicileEcommerce:e.domicile_ecommerce,stopDeskEcommerce:e.stop_desk_ecommerce}))}catch(e){return console.error("Supabase getWilayaTariffs error:",e),[]}}async function I(e){try{if(await n.from("wilaya_tariffs").delete().neq("id",0),e.length>0){let t=e.map(e=>({wilaya_id:e.wilaya_id||e.id,name:e.name,domicile_ecommerce:e.domicile_ecommerce||e.domicileEcommerce||e.home_delivery||e.homeDelivery||0,stop_desk_ecommerce:e.stop_desk_ecommerce||e.stopDeskEcommerce||e.stop_desk||e.stopDesk||0,order:e.order||1})),{error:r}=await n.from("wilaya_tariffs").insert(t);if(r)throw console.error("Supabase updateWilayaTariffs error:",r),r}console.log("Supabase: Updated wilaya tariffs")}catch(e){throw console.error("Supabase updateWilayaTariffs error:",e),e}}async function v(e){try{console.log("Supabase: Deducting stock for order:",e.id);let t=await l(e.productId);if(!t)return console.error("Supabase: Product not found for order:",e.productId),!1;let o=t.stock?.[e.selectedSize]?.[e.selectedColor]||0;if(o<e.quantity)return console.error("Supabase: Insufficient stock for order:",{productId:e.productId,size:e.selectedSize,color:e.selectedColor,requested:e.quantity,available:o}),!1;let a={...t.stock,[e.selectedSize]:{...t.stock?.[e.selectedSize],[e.selectedColor]:o-e.quantity}};if(!await p(e.productId,{stock:a,inStock:function(e){if(!e||"object"!=typeof e)return 0;let t=0;for(let r in e)if("object"==typeof e[r])for(let o in e[r])t+=Number(e[r][o])||0;return t}(a)>0}))return console.error("Supabase: Failed to update product stock for order:",e.id),!1;try{let{addInventory:t}=await r.e(8755).then(r.bind(r,78755));await t(e.productId,e.selectedSize,e.selectedColor,-e.quantity,`Order ${e.id} created - stock deducted`,"system")?console.log("Supabase: Successfully deducted inventory for order:",e.id):console.warn("Supabase: Failed to deduct inventory for order:",e.id)}catch(e){console.error("Supabase: Inventory deduction error:",e)}return console.log("Supabase: Successfully deducted stock for order:",e.id),!0}catch(e){return console.error("Supabase: Error deducting stock for order:",e),!1}}async function C(){try{let{data:e,error:t}=await n.from("maintenance_settings").select("*").eq("id","maintenance").single();if(t)return console.error("Supabase getMaintenanceSettings error:",t),"PGRST205"===t.code&&console.log("Maintenance settings table not found, using default settings"),{id:"maintenance",is_maintenance_mode:!1,drop_date:new Date(Date.now()+2592e6).toISOString(),maintenance_message:"We are currently performing maintenance. Please check back later.",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return e||{id:"maintenance",is_maintenance_mode:!1,drop_date:new Date(Date.now()+2592e6).toISOString(),maintenance_message:"We are currently performing maintenance. Please check back later.",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}catch(e){return console.error("Supabase getMaintenanceSettings error:",e),{id:"maintenance",is_maintenance_mode:!1,drop_date:new Date(Date.now()+2592e6).toISOString(),maintenance_message:"We are currently performing maintenance. Please check back later.",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}}async function z(e){try{let t={updated_at:new Date().toISOString()};void 0!==e.is_maintenance_mode&&(t.is_maintenance_mode=e.is_maintenance_mode),void 0!==e.drop_date&&(t.drop_date=e.drop_date),void 0!==e.maintenance_message&&(t.maintenance_message=e.maintenance_message),console.log("Updating maintenance settings with:",t);let{data:r,error:o}=await n.from("maintenance_settings").update(t).eq("id","maintenance").select().single();if(o){console.error("Update error:",o);let{data:t,error:r}=await n.from("maintenance_settings").insert([{id:"maintenance",is_maintenance_mode:e.is_maintenance_mode??!1,drop_date:e.drop_date??new Date(Date.now()+2592e6).toISOString(),maintenance_message:e.maintenance_message??"We are currently performing maintenance. Please check back later.",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(r)throw console.error("Insert error:",r),r;return console.log("Supabase: Created maintenance settings"),t}return console.log("Supabase: Updated maintenance settings"),r}catch(e){throw console.error("Supabase updateMaintenanceSettings error:",e),e}}async function O(){try{let{data:e,error:t}=await n.from("customers").select("*").order("created_at",{ascending:!1});if(t)throw console.error("Supabase getCustomers error:",t),t;return console.log("Supabase: Fetched",e?.length||0,"customers"),e||[]}catch(e){throw console.error("Supabase getCustomers error:",e),e}}async function P(e){try{let t=new Date().toISOString(),r={...e,id:`customer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,created_at:t,updated_at:t},{data:o,error:a}=await n.from("customers").insert([r]).select().single();if(a)throw console.error("Supabase addCustomer error:",a),a;return console.log("Supabase: Created customer:",o.id),{id:o.id,name:o.name,email:o.email,phone:o.phone,address:o.address,city:o.city,wilaya:o.wilaya,createdAt:new Date(o.created_at),updatedAt:new Date(o.updated_at)}}catch(e){throw console.error("Supabase addCustomer error:",e),e}}}};