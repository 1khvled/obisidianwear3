"use strict";exports.id=814,exports.ids=[814],exports.modules={4814:(e,t,r)=>{r.d(t,{LZ:()=>p,XK:()=>g,returnStockFromOrder:()=>h});var a=r(2409);let o="https://zrmxcjklkthpyanfslsw.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpybXhjamtsa3RocHlhbmZzbHN3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MDYxMzAsImV4cCI6MjA3MjQ4MjEzMH0.2Tjh9pPzc6BUGoV3lDUBymXzE_dvAGs1O_WewTdetE0";if(!o||!i)throw Error("Missing Supabase environment variables");let s=(0,a.eI)(o,i,{db:{schema:"public"},auth:{persistSession:!1,autoRefreshToken:!1},global:{headers:{"Cache-Control":"max-age=60"}}});class n{set(e,t,r=this.DEFAULT_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}get(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),null):t.data:null}invalidate(e){if(e){let t=[];this.cache.forEach((r,a)=>{a.includes(e)&&t.push(a)}),t.forEach(e=>this.cache.delete(e))}else this.cache.clear()}async preloadCriticalData(){try{console.log("Preloading critical data...");let e=await this.getProducts();this.set("products",e,this.LONG_TTL);let t=await this.getMaintenanceStatus();this.set("maintenance",t,this.DEFAULT_TTL),console.log("Critical data preloaded successfully")}catch(e){console.error("Error preloading data:",e)}}async getProducts(){let{data:e,error:t}=await s.from("products").select("*").order("created_at",{ascending:!1});if(t)throw t;return(e||[]).map(d)}async getMaintenanceStatus(){let{data:e,error:t}=await s.from("maintenance_status").select("*").single();if(t)throw t;return e}constructor(){this.cache=new Map,this.DEFAULT_TTL=6e4,this.LONG_TTL=3e5}}let c=new n;function d(e){return{id:e.id,name:e.name,description:e.description,price:e.price,originalPrice:e.original_price,image:e.image,images:e.images||[],stock:e.stock||{},category:e.category,sizes:e.sizes||[],colors:e.colors||[],inStock:e.in_stock,status:e.status||"available",rating:e.rating||0,reviews:e.reviews||0,sku:e.sku,weight:e.weight,dimensions:e.dimensions,tags:e.tags||[],featured:e.featured||!1,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}async function l(e){try{let t=c.get(`product_${e}`);if(t)return t;let{data:r,error:a}=await s.from("products").select("*").eq("id",e).single();if(a)return console.error("Database getProduct error:",a),null;let o=d(r);return c.set(`product_${e}`,o,3e5),o}catch(e){return console.error("Database getProduct error:",e),null}}async function u(e,t){try{let r={};void 0!==t.name&&(r.name=t.name),void 0!==t.description&&(r.description=t.description),void 0!==t.price&&(r.price=t.price),void 0!==t.originalPrice&&(r.original_price=t.originalPrice),void 0!==t.image&&(r.image=t.image),void 0!==t.images&&(r.images=t.images),void 0!==t.stock&&(r.stock=t.stock),void 0!==t.category&&(r.category=t.category),void 0!==t.sizes&&(r.sizes=t.sizes),void 0!==t.colors&&(r.colors=t.colors),void 0!==t.inStock&&(r.in_stock=t.inStock),void 0!==t.rating&&(r.rating=t.rating),void 0!==t.reviews&&(r.reviews=t.reviews),void 0!==t.sku&&(r.sku=t.sku),void 0!==t.weight&&(r.weight=t.weight),void 0!==t.dimensions&&(r.dimensions=t.dimensions),void 0!==t.tags&&(r.tags=t.tags),void 0!==t.featured&&(r.featured=t.featured);let{data:a,error:o}=await s.from("products").update(r).eq("id",e).select().single();if(o)throw console.error("Database updateProduct error:",o),o;let i=d(a);return c.invalidate("products"),c.invalidate(`product_${e}`),i}catch(e){throw console.error("Database updateProduct error:",e),e}}async function g(){try{let e=c.get("maintenance");if(e)return e;let{data:t,error:r}=await s.from("maintenance_status").select("*").single();if(r)return console.error("Database getMaintenanceStatus error:",r),null;return c.set("maintenance",t,3e4),t}catch(e){return console.error("Database getMaintenanceStatus error:",e),null}}async function p(e,t){try{let{error:r}=await s.from("maintenance_status").upsert({id:"maintenance",is_maintenance:e,drop_date:t||new Date().toISOString(),updated_at:new Date().toISOString()});if(r)return console.error("Database setMaintenanceStatus error:",r),!1;return c.invalidate("maintenance"),!0}catch(e){return console.error("Database setMaintenanceStatus error:",e),!1}}async function h(e){try{console.log("Database: Returning stock for order:",e.id);let t=await l(e.productId);if(!t)return console.error("Database: Product not found for order:",e.productId),!1;let r=t.stock?.[e.selectedSize]?.[e.selectedColor]||0,a={...t.stock,[e.selectedSize]:{...t.stock?.[e.selectedSize],[e.selectedColor]:r+e.quantity}};if(await u(e.productId,{stock:a,inStock:m(a)>0}))return console.log("Database: Successfully returned stock for order:",e.id,{productId:e.productId,size:e.selectedSize,color:e.selectedColor,quantity:e.quantity,newTotalStock:m(a)}),c.invalidate("products"),c.invalidate(`product_${e.productId}`),!0;return console.error("Database: Failed to return product stock for order:",e.id),!1}catch(e){return console.error("Database: Error returning stock for order:",e),!1}}function m(e){if(!e||"object"!=typeof e)return 0;let t=0;return Object.values(e).forEach(e=>{e&&"object"==typeof e&&Object.values(e).forEach(e=>{"number"==typeof e&&(t+=e)})}),t}}};