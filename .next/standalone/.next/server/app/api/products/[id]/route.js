"use strict";(()=>{var e={};e.id=3898,e.ids=[3898],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},25117:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>h,originalPathname:()=>P,patchFetch:()=>y,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>D});var o={};t.r(o),t.d(o,{DELETE:()=>l,GET:()=>a,PUT:()=>d});var s=t(95419),u=t(69108),i=t(99678),n=t(78070),c=t(4750);async function a(e,{params:r}){try{let e=r.id;if(!e)return n.Z.json({error:"Product ID is required"},{status:400});console.log("\uD83D\uDD0D Fetching product from database:",e);let{data:t,error:o}=await c.OQ.from("products").select("*").eq("id",e).single();if(o)return console.error("❌ Error fetching product:",o),n.Z.json({error:"Product not found"},{status:404});if(!t)return n.Z.json({error:"Product not found"},{status:404});console.log("\uD83D\uDCE6 Using product stock data directly:",t.stock);let s=t.stock||{},u=!1!==t.in_stock&&Object.keys(s).length>0&&Object.values(s).some(e=>Object.values(e).some(e=>e>0)),i={...t,stock:s,inStock:u};return console.log("✅ Product with stock data:",{id:t.id,name:t.name,stock:s,inStock:u}),n.Z.json(i)}catch(e){return console.error("❌ Error in product API:",e),n.Z.json({error:"Internal server error"},{status:500})}}async function d(e,{params:r}){try{let t=r.id,o=await e.json();if(!t)return n.Z.json({error:"Product ID is required"},{status:400});console.log("\uD83D\uDD27 Updating product:",t,{name:o.name,customSizeChart:o.customSizeChart,useCustomSizeChart:o.useCustomSizeChart,sizeChartCategory:o.sizeChartCategory});let{data:s,error:u}=await c.OQ.from("products").select("colors, sizes, stock").eq("id",t).single();if(u)return console.error("❌ Error fetching current product:",u),n.Z.json({error:"Failed to fetch current product"},{status:500});if(s){let e=s.colors||[],r=o.colors||[],u=s.sizes||[],i=o.sizes||[],n=e.filter(e=>!r.includes(e)),a=u.filter(e=>!i.includes(e));if(n.length>0||a.length>0){for(let e of(console.log("\uD83E\uDDF9 Cleaning up inventory for removed colors/sizes:",{removedColors:n,removedSizes:a}),n)){let{error:r}=await c.OQ.from("inventory").delete().eq("product_id",t).eq("color",e);r?console.error(`❌ Error deleting inventory for color ${e}:`,r):console.log(`✅ Deleted inventory records for color: ${e}`)}for(let e of a){let{error:r}=await c.OQ.from("inventory").delete().eq("product_id",t).eq("size",e);r?console.error(`❌ Error deleting inventory for size ${e}:`,r):console.log(`✅ Deleted inventory records for size: ${e}`)}}}let{data:i,error:a}=await c.OQ.from("products").update({name:o.name,description:o.description,price:o.price,category:o.category,image:o.image,images:o.images,sizes:o.sizes,colors:o.colors,stock:o.stock,in_stock:o.inStock,rating:o.rating,reviews:o.reviews,sku:o.sku,weight:o.weight,dimensions:o.dimensions,tags:o.tags,featured:o.featured,custom_size_chart:o.customSizeChart,use_custom_size_chart:o.useCustomSizeChart,size_chart_category:o.sizeChartCategory,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(a)return console.error("❌ Error updating product:",a),n.Z.json({error:"Failed to update product"},{status:500});if(!i)return n.Z.json({error:"Product not found"},{status:404});return console.log("✅ Product updated successfully:",i.id),n.Z.json({success:!0,data:i,message:"Product updated successfully"})}catch(e){return console.error("❌ Error in product update API:",e),n.Z.json({error:"Internal server error"},{status:500})}}async function l(e,{params:r}){try{let e=r.id;if(!e)return n.Z.json({error:"Product ID is required"},{status:400});if(console.log("\uD83D\uDD27 Products API: DELETE request for product ID:",e),await (0,c.Ir)(e))return console.log("✅ Products API: Product deleted successfully"),n.Z.json({success:!0,message:"Product deleted successfully",deletedId:e});return console.error("❌ Products API: Failed to delete product"),n.Z.json({success:!1,error:"Failed to delete product"},{status:500})}catch(e){return console.error("❌ Products API: DELETE error:",e),n.Z.json({success:!1,error:"Failed to delete product",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:u.x.APP_ROUTE,page:"/api/products/[id]/route",pathname:"/api/products/[id]",filename:"route",bundlePath:"app/api/products/[id]/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\Obsidian wear\\projectt\\src\\app\\api\\products\\[id]\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:m,headerHooks:h,staticGenerationBailout:D}=p,P="/api/products/[id]/route";function y(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:f})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[1638,6206,2409,4750],()=>t(25117));module.exports=o})();