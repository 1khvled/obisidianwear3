"use strict";(()=>{var e={};e.id=684,e.ids=[684],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},6366:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>f,originalPathname:()=>h,patchFetch:()=>w,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>y,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>S});var o={};t.r(o),t.d(o,{GET:()=>d,POST:()=>l,runtime:()=>u});var a=t(5419),s=t(9108),i=t(9678),n=t(8070),c=t(4750);let u="nodejs";async function d(){try{let e=await (0,c.Xp)();return console.log("Products API: GET request - returning",e.length,"products"),n.Z.json({success:!0,data:e,count:e.length,timestamp:Date.now()})}catch(e){return console.error("Products API: GET error:",e),n.Z.json({success:!1,error:"Failed to fetch products"},{status:500})}}async function l(e){try{let r=await e.json();if(!r.name||!r.price)return n.Z.json({success:!1,error:"Name and price are required"},{status:400});let t={id:Date.now().toString(),...r,createdAt:new Date,updatedAt:new Date},o=await (0,c.gK)(t);return console.log("Products API: POST request - created product:",t.id,t.name),n.Z.json({success:!0,data:o,message:"Product created successfully",timestamp:Date.now()},{status:201})}catch(e){return console.error("Products API: POST error:",e),n.Z.json({success:!1,error:"Failed to create product"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/products/route",pathname:"/api/products",filename:"route",bundlePath:"app/api/products/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\projectt\\src\\app\\api\\products\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:y,headerHooks:f,staticGenerationBailout:S}=p,h="/api/products/route";function w(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:g})}},4750:(e,r,t)=>{t.d(r,{$v:()=>_,AU:()=>g,Cs:()=>S,Ir:()=>p,OL:()=>w,OQ:()=>i,Sy:()=>b,Xp:()=>c,co:()=>y,e9:()=>I,fS:()=>f,gK:()=>d,ix:()=>v,n3:()=>k,nE:()=>z,nM:()=>l,wH:()=>h,wv:()=>u});var o=t(2409);let a="https://zrmxcjklkthpyanfslsw.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpybXhjamtsa3RocHlhbmZzbHN3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MDYxMzAsImV4cCI6MjA3MjQ4MjEzMH0.2Tjh9pPzc6BUGoV3lDUBymXzE_dvAGs1O_WewTdetE0";if(!a||!s)throw Error("Missing Supabase environment variables. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY");let i=(0,o.eI)(a,s);function n(e){return{id:e.id,name:e.name,description:e.description,price:e.price,originalPrice:e.original_price,image:e.image,images:e.images||[],stock:e.stock||{},category:e.category,sizes:e.sizes||[],colors:e.colors||[],inStock:e.in_stock,rating:e.rating||0,reviews:e.reviews||0,sku:e.sku,weight:e.weight,dimensions:e.dimensions,tags:e.tags||[],featured:e.featured||!1,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}async function c(){try{let{data:e,error:r}=await i.from("products").select("*").order("created_at",{ascending:!1});if(r)return console.error("Supabase getProducts error:",r),[];return(e||[]).map(n)}catch(e){return console.error("Supabase getProducts error:",e),[]}}async function u(e){try{let{data:r,error:t}=await i.from("products").select("*").eq("id",e).single();if(t)return console.error("Supabase getProduct error:",t),null;return n(r)}catch(e){return console.error("Supabase getProduct error:",e),null}}async function d(e){try{let r={id:e.id,name:e.name,description:e.description,price:e.price,original_price:e.originalPrice,image:e.image,images:e.images||[],stock:e.stock,category:e.category,sizes:e.sizes||[],colors:e.colors||[],in_stock:e.inStock,rating:e.rating,reviews:e.reviews,sku:e.sku,weight:e.weight,dimensions:e.dimensions,tags:e.tags||[],featured:e.featured||!1},{data:t,error:o}=await i.from("products").insert([r]).select().single();if(o)throw console.error("Supabase addProduct error:",o),o;return console.log("Supabase: Added product:",e.id),n(t)}catch(e){throw console.error("Supabase addProduct error:",e),e}}async function l(e,r){try{let t={};void 0!==r.name&&(t.name=r.name),void 0!==r.description&&(t.description=r.description),void 0!==r.price&&(t.price=r.price),void 0!==r.originalPrice&&(t.original_price=r.originalPrice),void 0!==r.image&&(t.image=r.image),void 0!==r.images&&(t.images=r.images),void 0!==r.stock&&(t.stock=r.stock),void 0!==r.category&&(t.category=r.category),void 0!==r.sizes&&(t.sizes=r.sizes),void 0!==r.colors&&(t.colors=r.colors),void 0!==r.inStock&&(t.in_stock=r.inStock),void 0!==r.rating&&(t.rating=r.rating),void 0!==r.reviews&&(t.reviews=r.reviews),void 0!==r.sku&&(t.sku=r.sku),void 0!==r.weight&&(t.weight=r.weight),void 0!==r.dimensions&&(t.dimensions=r.dimensions),void 0!==r.tags&&(t.tags=r.tags),void 0!==r.featured&&(t.featured=r.featured);let{data:o,error:a}=await i.from("products").update(t).eq("id",e).select().single();if(a)return console.error("Supabase updateProduct error:",a),null;return console.log("Supabase: Updated product:",e),n(o)}catch(e){return console.error("Supabase updateProduct error:",e),null}}async function p(e){try{let{error:r}=await i.from("products").delete().eq("id",e);if(r)return console.error("Supabase deleteProduct error:",r),!1;return console.log("Supabase: Deleted product:",e),!0}catch(e){return console.error("Supabase deleteProduct error:",e),!1}}function m(e){let r=e.items&&e.items.length>0?e.items[0]:{};return{id:e.id,productId:r.productId||"",productName:r.productName||"",productImage:r.productImage||"",customerName:r.customerName||"",customerPhone:r.customerPhone||"",customerEmail:r.customerEmail||"",customerAddress:r.customerAddress||"",wilayaId:r.wilayaId||0,wilayaName:r.wilayaName||"",shippingType:e.shipping_type||"homeDelivery",shippingCost:Number(e.shipping_cost)||0,quantity:r.quantity||1,selectedSize:r.selectedSize||"",selectedColor:r.selectedColor||"",subtotal:Number(e.total)-Number(e.shipping_cost)||0,total:Number(e.total)||0,orderDate:new Date(e.order_date),status:e.status||"pending",trackingNumber:e.tracking_number,notes:r.notes,paymentMethod:e.payment_method||"cod",paymentStatus:e.payment_status||"pending",estimatedDelivery:r.estimatedDelivery,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}async function g(){try{let{data:e,error:r}=await i.from("orders").select("*").order("order_date",{ascending:!1});if(r)return console.error("Supabase getOrders error:",r),[];return(e||[]).map(m)}catch(e){return console.error("Supabase getOrders error:",e),[]}}async function y(e){try{let{data:r,error:t}=await i.from("orders").select("*").eq("id",e).single();if(t)return console.error("Supabase getOrder error:",t),null;return m(r)}catch(e){return console.error("Supabase getOrder error:",e),null}}async function f(e){try{let r={id:e.id,customer_id:`CUST-${Date.now()}`,items:[{productId:e.productId,productName:e.productName,productImage:e.productImage,customerName:e.customerName,customerPhone:e.customerPhone,customerEmail:e.customerEmail,customerAddress:e.customerAddress,wilayaId:e.wilayaId,wilayaName:e.wilayaName,quantity:e.quantity,selectedSize:e.selectedSize,selectedColor:e.selectedColor,notes:e.notes,estimatedDelivery:e.estimatedDelivery}],total:e.total,shipping_cost:e.shippingCost,shipping_type:e.shippingType,payment_method:e.paymentMethod,payment_status:e.paymentStatus,status:e.status,tracking_number:e.trackingNumber,order_date:e.orderDate.toISOString(),created_at:e.createdAt.toISOString(),updated_at:e.updatedAt.toISOString()},{data:t,error:o}=await i.from("orders").insert([r]).select().single();if(o)throw console.error("Supabase addOrder error:",o),o;return console.log("Supabase: Added order:",e.id),m(t)}catch(e){throw console.error("Supabase addOrder error:",e),e}}async function S(e,r){try{let t={updated_at:new Date().toISOString()};void 0!==r.status&&(t.status=r.status),void 0!==r.paymentStatus&&(t.payment_status=r.paymentStatus),void 0!==r.trackingNumber&&(t.tracking_number=r.trackingNumber),void 0!==r.shippingType&&(t.shipping_type=r.shippingType),void 0!==r.shippingCost&&(t.shipping_cost=r.shippingCost),void 0!==r.total&&(t.total=r.total),void 0!==r.paymentMethod&&(t.payment_method=r.paymentMethod);let{data:o,error:a}=await i.from("orders").update(t).eq("id",e).select().single();if(a)return console.error("Supabase updateOrder error:",a),null;return console.log("Supabase: Updated order:",e),m(o)}catch(e){return console.error("Supabase updateOrder error:",e),null}}async function h(e){try{let{error:r}=await i.from("orders").delete().eq("id",e);if(r)return console.error("Supabase deleteOrder error:",r),!1;return console.log("Supabase: Deleted order:",e),!0}catch(e){return console.error("Supabase deleteOrder error:",e),!1}}async function w(){try{let{data:e,error:r}=await i.from("customers").select("*").order("created_at",{ascending:!1});if(r)return console.error("Supabase getCustomers error:",r),[];return e||[]}catch(e){return console.error("Supabase getCustomers error:",e),[]}}async function b(e){try{let{data:r,error:t}=await i.from("customers").insert([e]).select().single();if(t)throw console.error("Supabase addCustomer error:",t),t;return r}catch(e){throw console.error("Supabase addCustomer error:",e),e}}async function k(){try{let{data:e,error:r}=await i.from("wilaya_tariffs").select("*").order("order",{ascending:!0});if(r)return console.error("Supabase getWilayaTariffs error:",r),[];return e||[]}catch(e){return console.error("Supabase getWilayaTariffs error:",e),[]}}async function v(e){try{if(await i.from("wilaya_tariffs").delete().neq("id",0),e.length>0){let{error:r}=await i.from("wilaya_tariffs").insert(e);if(r)throw console.error("Supabase updateWilayaTariffs error:",r),r}console.log("Supabase: Updated wilaya tariffs")}catch(e){throw console.error("Supabase updateWilayaTariffs error:",e),e}}async function _(){try{let{data:e,error:r}=await i.from("products").select("id, name, sku, stock, sizes, colors, in_stock, category").order("name");if(r)return console.error("Supabase getInventory error:",r),[];return(e||[]).map(e=>({id:e.id,name:e.name,sku:e.sku,category:e.category,inStock:e.in_stock,stock:e.stock||{},sizes:e.sizes||[],colors:e.colors||[],totalStock:P(e.stock||{}),stockBySize:function(e,r,t){let o={};return r.forEach(r=>{o[r]={},t.forEach(t=>{o[r][t]=Number(e[r]?.[t])||0})}),o}(e.stock||{},e.sizes||[],e.colors||[])}))}catch(e){return console.error("Supabase getInventory error:",e),[]}}async function I(e,r){try{let t={updated_at:new Date().toISOString()};r.stock&&(t.stock=r.stock),void 0!==r.inStock&&(t.in_stock=r.inStock);let{data:o,error:a}=await i.from("products").update(t).eq("id",e).select().single();if(a)throw console.error("Supabase updateInventory error:",a),a;return console.log("Supabase: Updated inventory for product:",e),{id:o.id,name:o.name,stock:o.stock,inStock:o.in_stock,totalStock:P(o.stock)}}catch(e){throw console.error("Supabase updateInventory error:",e),e}}function P(e){if(!e||"object"!=typeof e)return 0;let r=0;for(let t in e)if("object"==typeof e[t])for(let o in e[t])r+=Number(e[t][o])||0;return r}async function z(e){try{console.log("Supabase: Deducting stock for order:",e.id);let r=await u(e.productId);if(!r)return console.error("Supabase: Product not found for order:",e.productId),!1;let t=r.stock?.[e.selectedSize]?.[e.selectedColor]||0;if(t<e.quantity)return console.error("Supabase: Insufficient stock for order:",{productId:e.productId,size:e.selectedSize,color:e.selectedColor,requested:e.quantity,available:t}),!1;let o={...r.stock,[e.selectedSize]:{...r.stock?.[e.selectedSize],[e.selectedColor]:t-e.quantity}};if(await l(e.productId,{stock:o,inStock:P(o)>0}))return console.log("Supabase: Successfully deducted stock for order:",e.id),!0;return console.error("Supabase: Failed to update product stock for order:",e.id),!1}catch(e){return console.error("Supabase: Error deducting stock for order:",e),!1}}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[638,206,409],()=>t(6366));module.exports=o})();