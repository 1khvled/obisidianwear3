"use strict";(()=>{var e={};e.id=364,e.ids=[364],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},8880:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>I,originalPathname:()=>T,patchFetch:()=>j,requestAsyncStorage:()=>w,routeModule:()=>v,serverHooks:()=>g,staticGenerationAsyncStorage:()=>q,staticGenerationBailout:()=>f});var s={};r.r(s),r.d(s,{DELETE:()=>h,GET:()=>p,PUT:()=>y});var n=r(5419),o=r(9108),i=r(9678),a=r(8070),u=r(2409),c=r(4627);let d="https://twlegtqcyydgjkycxngw.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR3bGVndHFjeXlkZ2preWN4bmd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxNzQ2MDAsImV4cCI6MjA3Mjc1MDYwMH0.uD9GD_ksHCDgmmPAgR7fcLUAJHRJtTkT-J-SVjU-WR0";if(!d||!l)throw Error("Missing Supabase environment variables");let m=(0,u.eI)(d,l);async function p(e,{params:t}){try{let{id:e}=t,{data:r,error:s}=await m.from("inventory").select(`
        *,
        products (
          id,
          name,
          image,
          price
        )
      `).eq("product_id",e).order("size",{ascending:!0});if(s)return console.error("Inventory API: GET error:",s),a.Z.json({success:!1,error:"Failed to fetch inventory"},{status:500});return a.Z.json({success:!0,data:r,message:"Inventory fetched successfully",timestamp:Date.now()})}catch(e){return console.error("Inventory API: GET error:",e),a.Z.json({success:!1,error:"Failed to fetch inventory"},{status:500})}}let y=(0,c.QO)(async(e,{params:t})=>{try{let{id:r}=t,s=await e.json(),{data:n,error:o}=await m.from("inventory").select("*").eq("id",r).single();if(o||!n)return a.Z.json({success:!1,error:"Inventory record not found"},{status:404});let{data:i,error:u}=await m.from("inventory").update({quantity:s.quantity,reserved_quantity:s.reservedQuantity||n.reserved_quantity,min_stock_level:s.minStockLevel||n.min_stock_level,max_stock_level:s.maxStockLevel||n.max_stock_level,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(u)return console.error("Inventory API: PUT error:",u),a.Z.json({success:!1,error:"Failed to update inventory"},{status:500});let c=s.quantity-n.quantity;return 0!==c&&await m.from("inventory_transactions").insert([{id:`TXN-${Date.now()}-${r}`,product_id:n.product_id,size:n.size,color:n.color,transaction_type:"adjustment",quantity_change:c,previous_quantity:n.quantity,new_quantity:s.quantity,reason:s.reason||"Manual adjustment",created_by:s.createdBy||"admin"}]),a.Z.json({success:!0,data:i,message:"Inventory updated successfully",timestamp:Date.now()})}catch(e){return console.error("Inventory API: PUT error:",e),a.Z.json({success:!1,error:"Failed to update inventory"},{status:500})}}),h=(0,c.QO)(async(e,{params:t})=>{try{let{id:e}=t,{error:r}=await m.from("inventory").delete().eq("id",e);if(r)return console.error("Inventory API: DELETE error:",r),a.Z.json({success:!1,error:"Failed to delete inventory record"},{status:500});return a.Z.json({success:!0,message:"Inventory record deleted successfully",timestamp:Date.now()})}catch(e){return console.error("Inventory API: DELETE error:",e),a.Z.json({success:!1,error:"Failed to delete inventory record"},{status:500})}}),v=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/inventory/[id]/route",pathname:"/api/inventory/[id]",filename:"route",bundlePath:"app/api/inventory/[id]/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\projectt\\src\\app\\api\\inventory\\[id]\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:w,staticGenerationAsyncStorage:q,serverHooks:g,headerHooks:I,staticGenerationBailout:f}=v,T="/api/inventory/[id]/route";function j(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:q})}},4627:(e,t,r)=>{r.d(t,{QO:()=>i});var s=r(8070);class n{constructor(e=6e4,t=100){this.requests=new Map,this.windowMs=e,this.maxRequests=t}isAllowed(e){let t=Date.now(),r=this.requests.get(e);return!r||t>r.resetTime?(this.requests.set(e,{count:1,resetTime:t+this.windowMs}),{allowed:!0,remaining:this.maxRequests-1,resetTime:t+this.windowMs}):r.count>=this.maxRequests?{allowed:!1,remaining:0,resetTime:r.resetTime}:(r.count++,this.requests.set(e,r),{allowed:!0,remaining:this.maxRequests-r.count,resetTime:r.resetTime})}cleanup(){let e=Date.now();this.requests.forEach((t,r)=>{e>t.resetTime&&this.requests.delete(r)})}}let o=new n(6e4,100);function i(e){return async(t,...r)=>{let n=new URL(t.url);if(["/api/maintenance","/api/test-db","/api/test-supabase"].some(e=>n.pathname.startsWith(e)))return e(t,...r);let i=function(e,t){let r=t.isAllowed(e);.01>Math.random()&&t.cleanup();let s={"X-RateLimit-Limit":t.maxRequests.toString(),"X-RateLimit-Remaining":r.remaining.toString(),"X-RateLimit-Reset":new Date(r.resetTime).toISOString()};return{allowed:r.allowed,headers:s}}(t.ip||t.headers.get("x-forwarded-for")||"unknown",o);return i.allowed?!function(e){let t=e.headers.get("authorization");return!!(t&&t.startsWith("Bearer "))&&t.substring(7)===(process.env.API_AUTH_TOKEN||"obsidian-api-token-2025")}(t)?s.Z.json({success:!1,error:"Unauthorized",message:"Authentication required"},{status:401,headers:i.headers}):e(t,...r):s.Z.json({success:!1,error:"Too Many Requests",message:"Rate limit exceeded. Please try again later."},{status:429,headers:i.headers})}}new n(3e5,5)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,206,290],()=>r(8880));module.exports=s})();