"use strict";(()=>{var e={};e.id=986,e.ids=[986,814],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},4833:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>w,originalPathname:()=>v,patchFetch:()=>k,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>y});var r={};a.r(r),a.d(r,{GET:()=>d,POST:()=>p});var n=a(5419),s=a(9108),i=a(9678),o=a(8070),c=a(4814);class u{static getInstance(){return u.instance||(u.instance=new u),u.instance}async getMaintenanceStatus(){let e=Date.now();if(this.cache&&e-this.cacheTime<this.CACHE_DURATION)return this.cache;try{let t=await (0,c.XK)();return t&&(this.cache=t,this.cacheTime=e),t}catch(e){return console.error("Error fetching maintenance status:",e),null}}async setMaintenanceStatus(e,t){try{console.log("Setting maintenance status:",{isMaintenance:e,dropDate:t});let a=await (0,c.LZ)(e,t);return a?(this.cache=null,this.cacheTime=0,console.log("Maintenance status updated successfully")):console.error("Failed to update maintenance status"),a}catch(e){return console.error("Error updating maintenance status:",e),!1}}async isMaintenanceMode(){let e=await this.getMaintenanceStatus();return e?.is_maintenance||!1}async getDropDate(){let e=await this.getMaintenanceStatus();return e?.drop_date||null}constructor(){this.cache=null,this.cacheTime=0,this.CACHE_DURATION=3e4}}let l=u.getInstance();async function d(){try{let e=await l.getMaintenanceStatus();return o.Z.json(e)}catch(e){return console.error("Error fetching maintenance status:",e),o.Z.json({error:"Failed to fetch maintenance status"},{status:500})}}async function p(e){try{let{isMaintenance:t,dropDate:a}=await e.json();if(await l.setMaintenanceStatus(t,a))return o.Z.json({success:!0});return o.Z.json({error:"Failed to update maintenance status"},{status:500})}catch(e){return console.error("Error updating maintenance status:",e),o.Z.json({error:"Failed to update maintenance status"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/maintenance/route",pathname:"/api/maintenance",filename:"route",bundlePath:"app/api/maintenance/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\projectt\\src\\app\\api\\maintenance\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:m,serverHooks:f,headerHooks:w,staticGenerationBailout:y}=h,v="/api/maintenance/route";function k(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},4814:(e,t,a)=>{a.d(t,{LZ:()=>h,XK:()=>p,returnStockFromOrder:()=>g});var r=a(2409);let n="https://zrmxcjklkthpyanfslsw.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpybXhjamtsa3RocHlhbmZzbHN3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MDYxMzAsImV4cCI6MjA3MjQ4MjEzMH0.2Tjh9pPzc6BUGoV3lDUBymXzE_dvAGs1O_WewTdetE0";if(!n||!s)throw Error("Missing Supabase environment variables");let i=(0,r.eI)(n,s,{db:{schema:"public"},auth:{persistSession:!1,autoRefreshToken:!1},global:{headers:{"Cache-Control":"max-age=60"}}});class o{set(e,t,a=this.DEFAULT_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:a})}get(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),null):t.data:null}invalidate(e){if(e){let t=[];this.cache.forEach((a,r)=>{r.includes(e)&&t.push(r)}),t.forEach(e=>this.cache.delete(e))}else this.cache.clear()}async preloadCriticalData(){try{console.log("Preloading critical data...");let e=await this.getProducts();this.set("products",e,this.LONG_TTL);let t=await this.getMaintenanceStatus();this.set("maintenance",t,this.DEFAULT_TTL),console.log("Critical data preloaded successfully")}catch(e){console.error("Error preloading data:",e)}}async getProducts(){let{data:e,error:t}=await i.from("products").select("*").order("created_at",{ascending:!1});if(t)throw t;return(e||[]).map(u)}async getMaintenanceStatus(){let{data:e,error:t}=await i.from("maintenance_status").select("*").single();if(t)throw t;return e}constructor(){this.cache=new Map,this.DEFAULT_TTL=6e4,this.LONG_TTL=3e5}}let c=new o;function u(e){return{id:e.id,name:e.name,description:e.description,price:e.price,originalPrice:e.original_price,image:e.image,images:e.images||[],stock:e.stock||{},category:e.category,sizes:e.sizes||[],colors:e.colors||[],inStock:e.in_stock,status:e.status||"available",rating:e.rating||0,reviews:e.reviews||0,sku:e.sku,weight:e.weight,dimensions:e.dimensions,tags:e.tags||[],featured:e.featured||!1,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}async function l(e){try{let t=c.get(`product_${e}`);if(t)return t;let{data:a,error:r}=await i.from("products").select("*").eq("id",e).single();if(r)return console.error("Database getProduct error:",r),null;let n=u(a);return c.set(`product_${e}`,n,3e5),n}catch(e){return console.error("Database getProduct error:",e),null}}async function d(e,t){try{let a={};void 0!==t.name&&(a.name=t.name),void 0!==t.description&&(a.description=t.description),void 0!==t.price&&(a.price=t.price),void 0!==t.originalPrice&&(a.original_price=t.originalPrice),void 0!==t.image&&(a.image=t.image),void 0!==t.images&&(a.images=t.images),void 0!==t.stock&&(a.stock=t.stock),void 0!==t.category&&(a.category=t.category),void 0!==t.sizes&&(a.sizes=t.sizes),void 0!==t.colors&&(a.colors=t.colors),void 0!==t.inStock&&(a.in_stock=t.inStock),void 0!==t.rating&&(a.rating=t.rating),void 0!==t.reviews&&(a.reviews=t.reviews),void 0!==t.sku&&(a.sku=t.sku),void 0!==t.weight&&(a.weight=t.weight),void 0!==t.dimensions&&(a.dimensions=t.dimensions),void 0!==t.tags&&(a.tags=t.tags),void 0!==t.featured&&(a.featured=t.featured);let{data:r,error:n}=await i.from("products").update(a).eq("id",e).select().single();if(n)throw console.error("Database updateProduct error:",n),n;let s=u(r);return c.invalidate("products"),c.invalidate(`product_${e}`),s}catch(e){throw console.error("Database updateProduct error:",e),e}}async function p(){try{let e=c.get("maintenance");if(e)return e;let{data:t,error:a}=await i.from("maintenance_status").select("*").single();if(a)return console.error("Database getMaintenanceStatus error:",a),null;return c.set("maintenance",t,3e4),t}catch(e){return console.error("Database getMaintenanceStatus error:",e),null}}async function h(e,t){try{let{error:a}=await i.from("maintenance_status").upsert({id:"maintenance",is_maintenance:e,drop_date:t||new Date().toISOString(),updated_at:new Date().toISOString()});if(a)return console.error("Database setMaintenanceStatus error:",a),!1;return c.invalidate("maintenance"),!0}catch(e){return console.error("Database setMaintenanceStatus error:",e),!1}}async function g(e){try{console.log("Database: Returning stock for order:",e.id);let t=await l(e.productId);if(!t)return console.error("Database: Product not found for order:",e.productId),!1;let a=t.stock?.[e.selectedSize]?.[e.selectedColor]||0,r={...t.stock,[e.selectedSize]:{...t.stock?.[e.selectedSize],[e.selectedColor]:a+e.quantity}};if(await d(e.productId,{stock:r,inStock:m(r)>0}))return console.log("Database: Successfully returned stock for order:",e.id,{productId:e.productId,size:e.selectedSize,color:e.selectedColor,quantity:e.quantity,newTotalStock:m(r)}),c.invalidate("products"),c.invalidate(`product_${e.productId}`),!0;return console.error("Database: Failed to return product stock for order:",e.id),!1}catch(e){return console.error("Database: Error returning stock for order:",e),!1}}function m(e){if(!e||"object"!=typeof e)return 0;let t=0;return Object.values(e).forEach(e=>{e&&"object"==typeof e&&Object.values(e).forEach(e=>{"number"==typeof e&&(t+=e)})}),t}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[638,206,409],()=>a(4833));module.exports=r})();