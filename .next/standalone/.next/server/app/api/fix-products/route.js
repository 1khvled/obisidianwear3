"use strict";(()=>{var e={};e.id=961,e.ids=[961],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},4283:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>f,originalPathname:()=>h,patchFetch:()=>S,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>y});var o={};t.r(o),t.d(o,{POST:()=>d,runtime:()=>u});var s=t(5419),a=t(9108),i=t(9678),c=t(8070),n=t(4750);let u="nodejs";async function d(){try{console.log("Fix Products API: Starting product fix...");let{data:e,error:r}=await n.OQ.from("products").select("*");if(r)return console.error("Fix Products API: Error fetching products:",r),c.Z.json({success:!1,error:"Failed to fetch products"},{status:500});console.log(`Fix Products API: Found ${e.length} products`);let t=0,o=[];for(let r of e){let e={},s=!1;if(r.colors&&0!==r.colors.length||(e.colors=["Black"],s=!0,console.log(`Fix Products API: Fixing colors for product: ${r.name}`)),(!r.stock||0===Object.keys(r.stock).length||Object.values(r.stock).every(e=>!e||0===Object.keys(e).length))&&(e.stock={S:{Black:10},M:{Black:15},L:{Black:12},XL:{Black:8}},s=!0,console.log(`Fix Products API: Fixing stock for product: ${r.name}`)),r.sizes&&0!==r.sizes.length||(e.sizes=["S","M","L","XL"],s=!0,console.log(`Fix Products API: Fixing sizes for product: ${r.name}`)),s){let{error:s}=await n.OQ.from("products").update(e).eq("id",r.id);s?(console.error(`Fix Products API: Error updating product ${r.name}:`,s),o.push({product:r.name,status:"error",error:s.message})):(console.log(`Fix Products API: ✅ Updated product: ${r.name}`),o.push({product:r.name,status:"success"}),t++)}else o.push({product:r.name,status:"no_changes_needed"})}return console.log(`Fix Products API: ✅ Fixed ${t} products successfully!`),c.Z.json({success:!0,message:`Fixed ${t} products successfully`,totalProducts:e.length,fixedCount:t,results:o,timestamp:Date.now()})}catch(e){return console.error("Fix Products API: Error:",e),c.Z.json({success:!1,error:"Failed to fix products"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/fix-products/route",pathname:"/api/fix-products",filename:"route",bundlePath:"app/api/fix-products/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\projectt\\src\\app\\api\\fix-products\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:g,headerHooks:f,staticGenerationBailout:y}=l,h="/api/fix-products/route";function S(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},4750:(e,r,t)=>{t.d(r,{$v:()=>I,AU:()=>g,Cs:()=>h,Ir:()=>p,OL:()=>k,OQ:()=>i,Sy:()=>b,Xp:()=>n,co:()=>f,e9:()=>_,fS:()=>y,gK:()=>d,ix:()=>v,n3:()=>w,nE:()=>x,nM:()=>l,wH:()=>S,wv:()=>u});var o=t(2409);let s="https://zrmxcjklkthpyanfslsw.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpybXhjamtsa3RocHlhbmZzbHN3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MDYxMzAsImV4cCI6MjA3MjQ4MjEzMH0.2Tjh9pPzc6BUGoV3lDUBymXzE_dvAGs1O_WewTdetE0";if(!s||!a)throw Error("Missing Supabase environment variables. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY");let i=(0,o.eI)(s,a);function c(e){return{id:e.id,name:e.name,description:e.description,price:e.price,originalPrice:e.original_price,image:e.image,images:e.images||[],stock:e.stock||{},category:e.category,sizes:e.sizes||[],colors:e.colors||[],inStock:e.in_stock,rating:e.rating||0,reviews:e.reviews||0,sku:e.sku,weight:e.weight,dimensions:e.dimensions,tags:e.tags||[],featured:e.featured||!1,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}async function n(){try{let{data:e,error:r}=await i.from("products").select("*").order("created_at",{ascending:!1});if(r)return console.error("Supabase getProducts error:",r),[];return(e||[]).map(c)}catch(e){return console.error("Supabase getProducts error:",e),[]}}async function u(e){try{let{data:r,error:t}=await i.from("products").select("*").eq("id",e).single();if(t)return console.error("Supabase getProduct error:",t),null;return c(r)}catch(e){return console.error("Supabase getProduct error:",e),null}}async function d(e){try{let r={id:e.id,name:e.name,description:e.description,price:e.price,original_price:e.originalPrice,image:e.image,images:e.images||[],stock:e.stock,category:e.category,sizes:e.sizes||[],colors:e.colors||[],in_stock:e.inStock,rating:e.rating,reviews:e.reviews,sku:e.sku,weight:e.weight,dimensions:e.dimensions,tags:e.tags||[],featured:e.featured||!1},{data:t,error:o}=await i.from("products").insert([r]).select().single();if(o)throw console.error("Supabase addProduct error:",o),o;return console.log("Supabase: Added product:",e.id),c(t)}catch(e){throw console.error("Supabase addProduct error:",e),e}}async function l(e,r){try{let t={};void 0!==r.name&&(t.name=r.name),void 0!==r.description&&(t.description=r.description),void 0!==r.price&&(t.price=r.price),void 0!==r.originalPrice&&(t.original_price=r.originalPrice),void 0!==r.image&&(t.image=r.image),void 0!==r.images&&(t.images=r.images),void 0!==r.stock&&(t.stock=r.stock),void 0!==r.category&&(t.category=r.category),void 0!==r.sizes&&(t.sizes=r.sizes),void 0!==r.colors&&(t.colors=r.colors),void 0!==r.inStock&&(t.in_stock=r.inStock),void 0!==r.rating&&(t.rating=r.rating),void 0!==r.reviews&&(t.reviews=r.reviews),void 0!==r.sku&&(t.sku=r.sku),void 0!==r.weight&&(t.weight=r.weight),void 0!==r.dimensions&&(t.dimensions=r.dimensions),void 0!==r.tags&&(t.tags=r.tags),void 0!==r.featured&&(t.featured=r.featured);let{data:o,error:s}=await i.from("products").update(t).eq("id",e).select().single();if(s)return console.error("Supabase updateProduct error:",s),null;return console.log("Supabase: Updated product:",e),c(o)}catch(e){return console.error("Supabase updateProduct error:",e),null}}async function p(e){try{let{error:r}=await i.from("products").delete().eq("id",e);if(r)return console.error("Supabase deleteProduct error:",r),!1;return console.log("Supabase: Deleted product:",e),!0}catch(e){return console.error("Supabase deleteProduct error:",e),!1}}function m(e){let r=e.items&&e.items.length>0?e.items[0]:{};return{id:e.id,productId:r.productId||"",productName:r.productName||"",productImage:r.productImage||"",customerName:r.customerName||"",customerPhone:r.customerPhone||"",customerEmail:r.customerEmail||"",customerAddress:r.customerAddress||"",wilayaId:r.wilayaId||0,wilayaName:r.wilayaName||"",shippingType:e.shipping_type||"homeDelivery",shippingCost:Number(e.shipping_cost)||0,quantity:r.quantity||1,selectedSize:r.selectedSize||"",selectedColor:r.selectedColor||"",subtotal:Number(e.total)-Number(e.shipping_cost)||0,total:Number(e.total)||0,orderDate:new Date(e.order_date),status:e.status||"pending",trackingNumber:e.tracking_number,notes:r.notes,paymentMethod:e.payment_method||"cod",paymentStatus:e.payment_status||"pending",estimatedDelivery:r.estimatedDelivery,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}async function g(){try{let{data:e,error:r}=await i.from("orders").select("*").order("order_date",{ascending:!1});if(r)return console.error("Supabase getOrders error:",r),[];return(e||[]).map(m)}catch(e){return console.error("Supabase getOrders error:",e),[]}}async function f(e){try{let{data:r,error:t}=await i.from("orders").select("*").eq("id",e).single();if(t)return console.error("Supabase getOrder error:",t),null;return m(r)}catch(e){return console.error("Supabase getOrder error:",e),null}}async function y(e){try{let r={id:e.id,customer_id:`CUST-${Date.now()}`,items:[{productId:e.productId,productName:e.productName,productImage:e.productImage,customerName:e.customerName,customerPhone:e.customerPhone,customerEmail:e.customerEmail,customerAddress:e.customerAddress,wilayaId:e.wilayaId,wilayaName:e.wilayaName,quantity:e.quantity,selectedSize:e.selectedSize,selectedColor:e.selectedColor,notes:e.notes,estimatedDelivery:e.estimatedDelivery}],total:e.total,shipping_cost:e.shippingCost,shipping_type:e.shippingType,payment_method:e.paymentMethod,payment_status:e.paymentStatus,status:e.status,tracking_number:e.trackingNumber,order_date:e.orderDate.toISOString(),created_at:e.createdAt.toISOString(),updated_at:e.updatedAt.toISOString()},{data:t,error:o}=await i.from("orders").insert([r]).select().single();if(o)throw console.error("Supabase addOrder error:",o),o;return console.log("Supabase: Added order:",e.id),m(t)}catch(e){throw console.error("Supabase addOrder error:",e),e}}async function h(e,r){try{let t={updated_at:new Date().toISOString()};void 0!==r.status&&(t.status=r.status),void 0!==r.paymentStatus&&(t.payment_status=r.paymentStatus),void 0!==r.trackingNumber&&(t.tracking_number=r.trackingNumber),void 0!==r.shippingType&&(t.shipping_type=r.shippingType),void 0!==r.shippingCost&&(t.shipping_cost=r.shippingCost),void 0!==r.total&&(t.total=r.total),void 0!==r.paymentMethod&&(t.payment_method=r.paymentMethod);let{data:o,error:s}=await i.from("orders").update(t).eq("id",e).select().single();if(s)return console.error("Supabase updateOrder error:",s),null;return console.log("Supabase: Updated order:",e),m(o)}catch(e){return console.error("Supabase updateOrder error:",e),null}}async function S(e){try{let{error:r}=await i.from("orders").delete().eq("id",e);if(r)return console.error("Supabase deleteOrder error:",r),!1;return console.log("Supabase: Deleted order:",e),!0}catch(e){return console.error("Supabase deleteOrder error:",e),!1}}async function k(){try{let{data:e,error:r}=await i.from("customers").select("*").order("created_at",{ascending:!1});if(r)return console.error("Supabase getCustomers error:",r),[];return e||[]}catch(e){return console.error("Supabase getCustomers error:",e),[]}}async function b(e){try{let{data:r,error:t}=await i.from("customers").insert([e]).select().single();if(t)throw console.error("Supabase addCustomer error:",t),t;return r}catch(e){throw console.error("Supabase addCustomer error:",e),e}}async function w(){try{let{data:e,error:r}=await i.from("wilaya_tariffs").select("*").order("order",{ascending:!0});if(r)return console.error("Supabase getWilayaTariffs error:",r),[];return e||[]}catch(e){return console.error("Supabase getWilayaTariffs error:",e),[]}}async function v(e){try{if(await i.from("wilaya_tariffs").delete().neq("id",0),e.length>0){let{error:r}=await i.from("wilaya_tariffs").insert(e);if(r)throw console.error("Supabase updateWilayaTariffs error:",r),r}console.log("Supabase: Updated wilaya tariffs")}catch(e){throw console.error("Supabase updateWilayaTariffs error:",e),e}}async function I(){try{let{data:e,error:r}=await i.from("products").select("id, name, sku, stock, sizes, colors, in_stock, category").order("name");if(r)return console.error("Supabase getInventory error:",r),[];return(e||[]).map(e=>({id:e.id,name:e.name,sku:e.sku,category:e.category,inStock:e.in_stock,stock:e.stock||{},sizes:e.sizes||[],colors:e.colors||[],totalStock:P(e.stock||{}),stockBySize:function(e,r,t){let o={};return r.forEach(r=>{o[r]={},t.forEach(t=>{o[r][t]=Number(e[r]?.[t])||0})}),o}(e.stock||{},e.sizes||[],e.colors||[])}))}catch(e){return console.error("Supabase getInventory error:",e),[]}}async function _(e,r){try{let t={updated_at:new Date().toISOString()};r.stock&&(t.stock=r.stock),void 0!==r.inStock&&(t.in_stock=r.inStock);let{data:o,error:s}=await i.from("products").update(t).eq("id",e).select().single();if(s)throw console.error("Supabase updateInventory error:",s),s;return console.log("Supabase: Updated inventory for product:",e),{id:o.id,name:o.name,stock:o.stock,inStock:o.in_stock,totalStock:P(o.stock)}}catch(e){throw console.error("Supabase updateInventory error:",e),e}}function P(e){if(!e||"object"!=typeof e)return 0;let r=0;for(let t in e)if("object"==typeof e[t])for(let o in e[t])r+=Number(e[t][o])||0;return r}async function x(e){try{console.log("Supabase: Deducting stock for order:",e.id);let r=await u(e.productId);if(!r)return console.error("Supabase: Product not found for order:",e.productId),!1;let t=r.stock?.[e.selectedSize]?.[e.selectedColor]||0;if(t<e.quantity)return console.error("Supabase: Insufficient stock for order:",{productId:e.productId,size:e.selectedSize,color:e.selectedColor,requested:e.quantity,available:t}),!1;let o={...r.stock,[e.selectedSize]:{...r.stock?.[e.selectedSize],[e.selectedColor]:t-e.quantity}};if(await l(e.productId,{stock:o,inStock:P(o)>0}))return console.log("Supabase: Successfully deducted stock for order:",e.id),!0;return console.error("Supabase: Failed to update product stock for order:",e.id),!1}catch(e){return console.error("Supabase: Error deducting stock for order:",e),!1}}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[638,206,409],()=>t(4283));module.exports=o})();