"use strict";(()=>{var e={};e.id=6103,e.ids=[6103],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},89079:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>D,originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>p,routeModule:()=>m,serverHooks:()=>_,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>y});var o={};t.r(o),t.d(o,{DELETE:()=>g,GET:()=>u,POST:()=>c,PUT:()=>l});var s=t(95419),a=t(69108),i=t(99678),n=t(78070),d=t(4750);async function u(){try{console.log("\uD83D\uDD27 Fetching made-to-order products...");let{data:e,error:r}=await d.OQ.from("made_to_order_products").select("id, name, description, price, image, images, colors, sizes, category, is_active, display_order").eq("is_active",!0).order("display_order",{ascending:!0});if(console.log("\uD83D\uDD27 Optimized query result:",{dataLength:e?.length,error:r}),r){console.log("\uD83D\uDD27 Trying without is_active filter...");let t=await d.OQ.from("made_to_order_products").select("id, name, description, price, image, images, colors, sizes, category, is_active, display_order").order("display_order",{ascending:!0});e=t.data,r=t.error,console.log("\uD83D\uDD27 Simple query result:",{dataLength:e?.length,error:r})}if(r){console.log("\uD83D\uDD27 Trying basic query...");let t=await d.OQ.from("made_to_order_products").select("id, name, description, price, image, images, colors, sizes, category, is_active, display_order");e=t.data,r=t.error,console.log("\uD83D\uDD27 Basic query result:",{dataLength:e?.length,error:r})}if(r)return console.error("❌ Error fetching made-to-order products:",r),n.Z.json({error:"Failed to fetch products",details:r.message,code:r.code},{status:500});let t=(e||[]).filter(e=>!1!==e.is_active);return console.log("✅ Successfully fetched products:",t.length),n.Z.json(t)}catch(e){return console.error("❌ Error in made-to-order GET:",e),n.Z.json({error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function c(e){try{let{name:r,description:t,price:o,image:s,images:a,colors:i,sizes:u,category:c,tags:l,displayOrder:g,customSizeChart:m,useCustomSizeChart:p,sizeChartCategory:h}=await e.json();if(!r||!o)return n.Z.json({error:"Name and price are required"},{status:400});let _=s,D=a||[];s&&s.length>500&&(console.warn("⚠️ Image data is too large for VARCHAR(500) schema. Length:",s.length),console.warn("⚠️ Moving image to images array instead"),D=[s,...a||[]],_="");let{data:y,error:f}=await d.OQ.from("made_to_order_products").insert({name:r,description:t,price:o,image:_,images:D,colors:i||["Noir"],sizes:u||["S","M","L","XL"],category:c||"Custom",tags:l||[],display_order:g||0,is_active:!0,custom_size_chart:m||null,use_custom_size_chart:p||!1,size_chart_category:h||c||"Custom"}).select().single();if(f)return console.error("Error creating made-to-order product:",f),n.Z.json({error:"Failed to create product"},{status:500});return n.Z.json(y,{status:201})}catch(e){return console.error("Error in made-to-order POST:",e),n.Z.json({error:"Internal server error"},{status:500})}}async function l(e){try{let{id:r,name:t,description:o,price:s,image:a,images:i,colors:u,sizes:c,category:l,tags:g,displayOrder:m,isActive:p,customSizeChart:h,useCustomSizeChart:_,sizeChartCategory:D}=await e.json();if(!r)return n.Z.json({error:"Product ID is required"},{status:400});console.log("\uD83D\uDD04 Updating made-to-order product:",{id:r,name:t,hasImage:!!a,imageLength:a?.length});let y="",f=i||[];a&&(a.startsWith("data:")&&a.length>1e3?(console.warn("⚠️ Large data URL image detected, moving to images array"),f=[a,...i||[]],y=""):a.length>500?(console.warn("⚠️ Image data too large for VARCHAR(500), moving to images array"),f=[a,...i||[]],y=""):y=a);let v={name:t||"",description:o||"",price:s||0,category:l||"Custom",display_order:m||0,is_active:void 0===p||p,custom_size_chart:h||null,use_custom_size_chart:_||!1,size_chart_category:D||l||"Custom"};y&&(v.image=y),f.length>0&&(v.images=f),u&&u.length>0&&(v.colors=u),c&&c.length>0&&(v.sizes=c),g&&g.length>0&&(v.tags=g),console.log("\uD83D\uDCDD Update data prepared:",{id:r,hasImage:!!v.image,imagesCount:v.images?.length||0,colorsCount:v.colors?.length||0,sizesCount:v.sizes?.length||0});let j=d.OQ.from("made_to_order_products").update(v).eq("id",r).select().single(),w=new Promise((e,r)=>setTimeout(()=>r(Error("Database operation timeout")),1e4)),{data:E,error:q}=await Promise.race([j,w]);if(q){if(console.error("❌ Error updating made-to-order product:",q),"57014"===q.code)return n.Z.json({error:"Database timeout - please try again with smaller images or contact support"},{status:408});return n.Z.json({error:"Failed to update product",details:q.message,code:q.code},{status:500})}return console.log("✅ Product updated successfully:",E?.id),n.Z.json(E)}catch(e){if(console.error("❌ Error in made-to-order PUT:",e),e instanceof Error&&e.message.includes("timeout"))return n.Z.json({error:"Request timeout - please try again with smaller images"},{status:408});return n.Z.json({error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function g(e){try{let{searchParams:r}=new URL(e.url),t=r.get("id");if(!t)return n.Z.json({error:"Product ID is required"},{status:400});let{error:o}=await d.OQ.from("made_to_order_products").delete().eq("id",t);if(o)return console.error("Error deleting made-to-order product:",o),n.Z.json({error:"Failed to delete product"},{status:500});return n.Z.json({message:"Product deleted successfully"})}catch(e){return console.error("Error in made-to-order DELETE:",e),n.Z.json({error:"Internal server error"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/made-to-order/route",pathname:"/api/made-to-order",filename:"route",bundlePath:"app/api/made-to-order/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\projectt\\src\\app\\api\\made-to-order\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,serverHooks:_,headerHooks:D,staticGenerationBailout:y}=m,f="/api/made-to-order/route";function v(){return(0,i.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:h})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[1638,6206,2409,4750],()=>t(89079));module.exports=o})();