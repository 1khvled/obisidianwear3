"use strict";(()=>{var e={};e.id=7143,e.ids=[7143],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},67349:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>y,originalPathname:()=>f,patchFetch:()=>g,requestAsyncStorage:()=>v,routeModule:()=>d,serverHooks:()=>p,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>q});var n={};t.r(n),t.d(n,{POST:()=>l});var o=t(95419),a=t(69108),i=t(99678),s=t(78070),u=t(4750);async function l(e){try{let{productId:r,size:t,color:n,quantity:o}=await e.json();if(!r||!t||!n||!o)return s.Z.json({error:"Missing required fields"},{status:400});console.log("\uD83D\uDD12 Reserving inventory from inventory table:",{productId:r,size:t,color:n,quantity:o});let{data:a,error:i}=await u.OQ.from("inventory").select("available_quantity, quantity, reserved_quantity").eq("product_id",r).eq("size",t).eq("color",n).single();if(i||!a)return console.error("❌ Error fetching inventory:",i),s.Z.json({error:"Inventory record not found"},{status:404});let l=a.available_quantity;if(l<o)return console.log("❌ Insufficient stock:",{available:l,requested:o}),s.Z.json({error:`Only ${l} items available in ${t} ${n}`},{status:400});let d=a.reserved_quantity+o,{error:v}=await u.OQ.from("inventory").update({reserved_quantity:d,last_updated:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("product_id",r).eq("size",t).eq("color",n);if(v)return console.error("❌ Error updating inventory:",v),s.Z.json({error:"Failed to reserve inventory"},{status:500});let{error:c}=await u.OQ.from("inventory_transactions").insert({id:`TXN-${Date.now()}-${r}-${t}-${n}`,product_id:r,size:t,color:n,transaction_type:"reserve",quantity_change:o,previous_quantity:a.quantity,new_quantity:a.quantity,reason:"Cart reservation",created_by:"system"});return c&&console.warn("Failed to log inventory transaction:",c),console.log("✅ Inventory reserved successfully:",{productId:r,size:t,color:n,reserved:o,available:l-o}),s.Z.json({success:!0,reserved:o,remaining:l-o})}catch(e){return console.error("❌ Error in inventory reserve:",e),s.Z.json({error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/inventory/reserve/route",pathname:"/api/inventory/reserve",filename:"route",bundlePath:"app/api/inventory/reserve/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\projectt\\src\\app\\api\\inventory\\reserve\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:v,staticGenerationAsyncStorage:c,serverHooks:p,headerHooks:y,staticGenerationBailout:q}=d,f="/api/inventory/reserve/route";function g(){return(0,i.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:c})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[1638,6206,2409,4750],()=>t(67349));module.exports=n})();