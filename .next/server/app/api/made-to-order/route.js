"use strict";(()=>{var e={};e.id=6103,e.ids=[6103],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},18591:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>_,originalPathname:()=>j,patchFetch:()=>w,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>y});var s={};t.r(s),t.d(s,{DELETE:()=>m,GET:()=>c,POST:()=>d,PUT:()=>l});var o=t(95419),a=t(69108),n=t(99678),i=t(78070),u=t(4750);async function c(){performance.now();try{let e=[],r=null;try{performance.now();let t=u.OQ.from("made_to_order_products").select("id, name, price, image, images, description, colors, sizes, category").order("display_order",{ascending:!0}).order("created_at",{ascending:!1}).limit(20),s=await t;performance.now(),e=s.data||[],r=s.error}catch(t){performance.now(),e=[],r={code:"QUERY_ERROR",message:t instanceof Error?t.message:"Query failed"}}r&&(e=[]);let t=e||[],s=i.Z.json({success:!0,data:t});return s.headers.set("Cache-Control","no-cache, no-store, must-revalidate"),s.headers.set("Pragma","no-cache"),s.headers.set("Expires","0"),s.headers.set("X-Content-Type-Options","nosniff"),s.headers.set("X-Frame-Options","DENY"),performance.now(),s}catch(e){return i.Z.json({error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function d(e){try{let{name:r,description:t,price:s,image:o,images:a,colors:n,sizes:c,category:d,tags:l,displayOrder:m,customSizeChart:p,useCustomSizeChart:g,sizeChartCategory:h,stock:f}=await e.json();if(!r||!s)return i.Z.json({error:"Name and price are required"},{status:400});let _=o,y=a||[];o&&o.length>500&&(y=[o,...a||[]],_="");let{data:j,error:w}=await u.OQ.from("made_to_order_products").insert({name:r,description:t,price:s,image:_,images:y,colors:n||["Noir"],sizes:c||["S","M","L","XL"],category:d||"Custom",tags:l||[],display_order:m||0,custom_size_chart:p||null,use_custom_size_chart:g||!1,size_chart_category:h||d||"Custom"}).select().single();if(w)return i.Z.json({error:"Failed to create product",details:w.message,code:w.code},{status:500});return i.Z.json({success:!0,data:j},{status:201})}catch(e){return i.Z.json({error:"Internal server error"},{status:500})}}async function l(e){try{let{id:r,name:t,description:s,price:o,image:a,images:n,colors:c,sizes:d,category:l,tags:m,displayOrder:p,isActive:g,customSizeChart:h,useCustomSizeChart:f,sizeChartCategory:_}=await e.json();if(!r)return i.Z.json({error:"Product ID is required"},{status:400});let y="",j=n||[];a&&(a.startsWith("data:")&&a.length>1e3?(j=[a,...n||[]],y=""):a.length>500?(j=[a,...n||[]],y=""):y=a);let w={name:t||"",description:s||"",price:o||0,category:l||"Custom",display_order:p||0,custom_size_chart:h||null,use_custom_size_chart:f||!1,size_chart_category:_||l||"Custom"};y&&(w.image=y),j.length>0&&(w.images=j),c&&c.length>0&&(w.colors=c),d&&d.length>0&&(w.sizes=d),m&&m.length>0&&(w.tags=m);let Z=u.OQ.from("made_to_order_products").update(w).eq("id",r).select().single(),q=new Promise((e,r)=>setTimeout(()=>r(Error("Database operation timeout")),1e4)),{data:P,error:E}=await Promise.race([Z,q]);if(E){if("57014"===E.code)return i.Z.json({error:"Database timeout - please try again with smaller images or contact support"},{status:408});return i.Z.json({error:"Failed to update product",details:E.message,code:E.code},{status:500})}return i.Z.json({success:!0,data:P})}catch(e){if(e instanceof Error&&e.message.includes("timeout"))return i.Z.json({error:"Request timeout - please try again with smaller images"},{status:408});return i.Z.json({error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function m(e){try{let{searchParams:r}=new URL(e.url),t=r.get("id");if(!t)return i.Z.json({error:"Product ID is required"},{status:400});let{error:s}=await u.OQ.from("made_to_order_products").delete().eq("id",t);if(s)return i.Z.json({error:"Failed to delete product"},{status:500});return i.Z.json({success:!0,message:"Product deleted successfully"})}catch(e){return i.Z.json({error:"Internal server error"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/made-to-order/route",pathname:"/api/made-to-order",filename:"route",bundlePath:"app/api/made-to-order/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\Obsidian wear\\projectt\\src\\app\\api\\made-to-order\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:f,headerHooks:_,staticGenerationBailout:y}=p,j="/api/made-to-order/route";function w(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1638,6206,2409,4750],()=>t(18591));module.exports=s})();