"use strict";(()=>{var e={};e.id=684,e.ids=[684],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},6366:(e,t,s)=>{s.r(t),s.d(t,{headerHooks:()=>P,originalPathname:()=>y,patchFetch:()=>z,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>q,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>f});var r={};s.r(r),s.d(r,{GET:()=>m,POST:()=>p,runtime:()=>d});var i=s(5419),a=s(9108),n=s(9678),o=s(8070),u=s(4750),c=s(4627),l=s(316);let d="nodejs";async function m(){try{let e=await (0,u.Xp)();return console.log("Products API: GET request - returning",e.length,"products"),o.Z.json({success:!0,data:e,count:e.length,timestamp:Date.now()})}catch(e){return console.error("Products API: GET error:",e),o.Z.json({success:!1,error:"Failed to fetch products"},{status:500})}}let p=(0,c.QO)(async e=>{try{let t=await e.json(),s=l.v.validateRequired(t,["name","price"]);if(!s.isValid)return o.Z.json({success:!1,error:`Missing required fields: ${s.missingFields.join(", ")}`},{status:400});if(!l.v.validateLength(t.name,1,100))return o.Z.json({success:!1,error:"Product name must be between 1 and 100 characters"},{status:400});if(!l.v.isValidNumber(t.price,0,999999))return o.Z.json({success:!1,error:"Price must be a valid number between 0 and 999999"},{status:400});let r=l.v.sanitizeProductData(t),i={id:Date.now().toString(),...r,createdAt:new Date,updatedAt:new Date},a=await (0,u.gK)(i);return console.log("Products API: POST request - created product:",i.id,i.name),o.Z.json({success:!0,data:a,message:"Product created successfully",timestamp:Date.now()},{status:201})}catch(e){return console.error("Products API: POST error:",e),o.Z.json({success:!1,error:"Failed to create product"},{status:500})}}),h=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/products/route",pathname:"/api/products",filename:"route",bundlePath:"app/api/products/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\projectt\\src\\app\\api\\products\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:w,serverHooks:q,headerHooks:P,staticGenerationBailout:f}=h,y="/api/products/route";function z(){return(0,n.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:w})}},4627:(e,t,s)=>{s.d(t,{QO:()=>n});var r=s(8070);class i{constructor(e=6e4,t=100){this.requests=new Map,this.windowMs=e,this.maxRequests=t}isAllowed(e){let t=Date.now(),s=this.requests.get(e);return!s||t>s.resetTime?(this.requests.set(e,{count:1,resetTime:t+this.windowMs}),{allowed:!0,remaining:this.maxRequests-1,resetTime:t+this.windowMs}):s.count>=this.maxRequests?{allowed:!1,remaining:0,resetTime:s.resetTime}:(s.count++,this.requests.set(e,s),{allowed:!0,remaining:this.maxRequests-s.count,resetTime:s.resetTime})}cleanup(){let e=Date.now();this.requests.forEach((t,s)=>{e>t.resetTime&&this.requests.delete(s)})}}let a=new i(6e4,100);function n(e){return async(t,...s)=>{let i=new URL(t.url);if(["/api/maintenance","/api/test-db","/api/test-supabase"].some(e=>i.pathname.startsWith(e)))return e(t,...s);let n=function(e,t){let s=t.isAllowed(e);.01>Math.random()&&t.cleanup();let r={"X-RateLimit-Limit":t.maxRequests.toString(),"X-RateLimit-Remaining":s.remaining.toString(),"X-RateLimit-Reset":new Date(s.resetTime).toISOString()};return{allowed:s.allowed,headers:r}}(t.ip||t.headers.get("x-forwarded-for")||"unknown",a);return n.allowed?!function(e){let t=e.headers.get("authorization");return!!(t&&t.startsWith("Bearer "))&&t.substring(7)===(process.env.API_AUTH_TOKEN||"obsidian-api-token-2025")}(t)?r.Z.json({success:!1,error:"Unauthorized",message:"Authentication required"},{status:401,headers:n.headers}):e(t,...s):r.Z.json({success:!1,error:"Too Many Requests",message:"Rate limit exceeded. Please try again later."},{status:429,headers:n.headers})}}new i(3e5,5)},316:(e,t,s)=>{s.d(t,{v:()=>r});class r{static sanitizeHtml(e){return"string"!=typeof e?"":e.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").trim()}static isValidEmail(e){return"string"==typeof e&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.trim())}static isValidPhone(e){return"string"==typeof e&&/^[\+]?[0-9\s\-\(\)]{8,}$/.test(e.trim())}static validateRequired(e,t){let s=[];for(let r of t)e[r]&&("string"!=typeof e[r]||""!==e[r].trim())||s.push(r);return{isValid:0===s.length,missingFields:s}}static validateLength(e,t,s){if("string"!=typeof e)return!1;let r=e.trim().length;return r>=t&&r<=s}static isValidNumber(e,t,s){let r=Number(e);return!isNaN(r)&&(void 0===t||!(r<t))&&(void 0===s||!(r>s))}static sanitizeProductData(e){return{...e,name:this.sanitizeHtml(e.name||""),description:this.sanitizeHtml(e.description||""),category:this.sanitizeHtml(e.category||""),price:this.isValidNumber(e.price,0,999999)?Number(e.price):0,stock:e.stock||{},image:this.sanitizeHtml(e.image||""),colors:Array.isArray(e.colors)?e.colors.map(e=>this.sanitizeHtml(e)):[],sizes:Array.isArray(e.sizes)?e.sizes.map(e=>this.sanitizeHtml(e)):[]}}static sanitizeOrderData(e){return{...e,customerName:this.sanitizeHtml(e.customerName||""),customerEmail:this.isValidEmail(e.customerEmail)?e.customerEmail.trim():"",customerPhone:this.isValidPhone(e.customerPhone)?e.customerPhone.trim():"",customerAddress:this.sanitizeHtml(e.customerAddress||""),productName:this.sanitizeHtml(e.productName||""),selectedSize:this.sanitizeHtml(e.selectedSize||""),selectedColor:this.sanitizeHtml(e.selectedColor||""),notes:this.sanitizeHtml(e.notes||""),quantity:this.isValidNumber(e.quantity,1,100)?Number(e.quantity):1,total:this.isValidNumber(e.total,0,999999)?Number(e.total):0}}}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[638,206,290,750],()=>s(6366));module.exports=r})();